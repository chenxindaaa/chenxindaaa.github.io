<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>Terminology</title>
    <link href="/Electronic-Design-Automation/Logic-Synthesis/Terminology/"/>
    <url>/Electronic-Design-Automation/Logic-Synthesis/Terminology/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="一terminology">一、Terminology</h1><h2 id="logic-boolean-function">1.1 Logic (Boolean) function</h2><ul><li>Boolean Satisfiability</li></ul><figure><img src="image-10.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>literals, variable, clauses</li><li>minterms, maxterms</li><li>cubes</li></ul><figure><img src="image-11.png" alt="alt text" /><figcaption>alt text</figcaption></figure><p>bcd' = 1, b' + c' + d = 0, f(a, b, c, d) = 0</p><ul><li>Completely specified logic function</li></ul><figure><img src="image-1.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>Incompletely specified logic function</li></ul><figure><img src="image-2.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>onset</li></ul><figure><img src="image-3.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>offset</li></ul><figure><img src="image-4.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>DCset</li></ul><figure><img src="image-5.png" alt="alt text" /><figcaption>alt text</figcaption></figure><h2 id="logic-network">1.2 logic network</h2><ul><li>Primary inputs(PI), Primary outputs(PO)</li><li>Logic nodes</li><li>Fanins / Fanouts</li><li>Transitive fain /fanout cone</li><li>Re-convergent paths</li></ul><figure><img src="image.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>Cut</li></ul><figure><img src="image-7.png" alt="alt text" /><figcaption>alt text</figcaption></figure><figure><img src="image-8.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>Window</li></ul><figure><img src="image-6.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>Bitwise Simulation</li></ul><figure><img src="image-9.png" alt="alt text" /><figcaption>alt text</figcaption></figure><ul><li>MFFC (a set of nodes which no paths to PO if target node is removed)</li></ul><h2 id="representation-overview">1.3 Representation Overview</h2><ul><li><p>Truth Table(TT) are the natural representation of logic functions</p><ul><li><p>Not practical for large functions</p></li><li><p>Still good for functions up to 16 variables</p></li></ul></li><li>SOP is widely used in synthesis tools since 1980’s<ul><li>More compact than TT, but not canonical</li><li>Can be efficiently minimized (SOP minimization by Espresso, ISOP computation) and translated into multi-level forms (algebraic factoring)</li></ul></li><li>BDD is a useful representation discovered around 1986<ul><li>Canonical (for a given function, there is only one BDD)</li><li>Very good, but only if (a) it can be constructed, (b) it is not too large</li><li>Unreliable (non-robust) for many industrial circuits</li></ul></li><li>AIG is an up-and-coming representation!<ul><li>Compact, easy to construct, can be made “canonical” using a SAT solver</li><li>Unifies the synthesis/mapping/verification flow</li><li>The main reason to give this talk</li></ul></li></ul><figure><img src="image-12.png" alt="alt text" /><figcaption>alt text</figcaption></figure><p>What Representation to Use? - For small functions (up to 16 inputs) - TT works the best (local transforms, decomposition, factoring, etc.) - For medium-sized functions (16-100 inputs) - In some cases, BDDs are still used (reachability analysis) - Typically, it is better to represent as AIGs - Translate AIG into CNF and use SAT solver for logic manipulation - Sometimes need interpolation or SAT assignment enumeration - For large industrial circuits (&gt;100 inputs, &gt;10,000 gates) - Traditional LN representation is not efficient - AIGs work remarkably well - Lead to efficient synthesis - Are a natural representation for technology mapping - Easy to translate into CNF for SAT solving - Etc</p><p>What are Typical Transformations? - Typical transformations of representations - For SOP, minimize cubes/literals - For BDD, minimize nodes/width - For AIG, restructure, minimize nodes/levels - For LN, restructure, minimize area/delay</p><h2 id="referenced">Referenced</h2><p><a href="https://cc.ee.ntu.edu.tw/~jhjiang/instruction/courses/fall14-lsv/lec01-abc_2p.pdf">https://cc.ee.ntu.edu.tw/~jhjiang/instruction/courses/fall14-lsv/lec01-abc_2p.pdf</a></p>]]></content>
    
    
    <categories>
      
      <category>Electronic Design Automation</category>
      
      <category>Logic Synthesis</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Karnaugh Map</title>
    <link href="/Electronic-Design-Automation/Logic-Synthesis/Logic%20Synthesis/"/>
    <url>/Electronic-Design-Automation/Logic-Synthesis/Logic%20Synthesis/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="一karnaugh-map">一、Karnaugh Map</h1><h2 id="最小项">1.1 最小项</h2><p>最小项的定义：一个函数的某个<strong>乘积项</strong>包含了函数的全部变量，其中每个变量都以原变量或反变量的形式出现，且仅出现一次，则这个乘积项称为该函数的一个标准积项，通常称为最小项。</p><p>最小项的表示方法：通常用<span class="math inline">\(m_i\)</span>来表示最小项。</p><p>下标i的确定方式：把最小项中原变量记为1，反变量记为0，当变量顺序确定后，可以按顺序排列成一个二进制数，则与这个二进制数相对应的十进制数，就是这个最小项的下标i。</p><p><strong>Example:</strong></p><p>函数<span class="math inline">\(L(A,B,C)\)</span>的最小项为：</p><p><span class="math display">\[\overline{A}\overline{B}\overline{C}, \overline{A}\overline{B}C, \overline{A}B\overline{C}, \overline{A}BC, A\overline{B}\overline{C}, A\overline{B}C, AB\overline{C}, ABC\]</span></p><p>分别对应：</p><p><span class="math display">\[000, 001, 010, 011, 100, 101, 110, 111\]</span></p><p><span class="math inline">\(m_i\)</span>的表达方式：</p><p><span class="math display">\[m_0, m_1, m_2, m_3, m_4, m_5, m_6, m_7\]</span></p><p>最小项的的相邻性：任何两个最小项如果他们只有一个因子不同，其余因子都相同，则称这两个最小项为相邻最小项。</p><p><strong>Example</strong>：<span class="math inline">\(m_0\)</span>和<span class="math inline">\(m_1\)</span>具有相邻性，<span class="math inline">\(m_1\)</span>和<span class="math inline">\(m_2\)</span>却没有，因为他们有两个不同的因子。</p><p>相邻的两个最小项之和可以合并一项，消去一个变量。如：</p><p><span class="math display">\[m_0 + m_2 = \overline{A}\overline{B}\overline{C} + \overline{A}B\overline{C} = \overline{A}(\overline{B} + B)\overline{C} = \overline{A}\overline{C}\]</span></p><h2 id="卡诺图">1.2 卡诺图</h2><ul><li>一种描述逻辑函数特殊方格图。</li><li>每格代表一个最小项，上下左右相邻就具备相邻性。</li><li>有n个变量，最小项就有<span class="math inline">\(2^n\)</span>且卡诺图也由<span class="math inline">\(2^n\)</span>个格子构成。</li></ul><p>两变量卡诺图：</p><figure><img src="https://img-blog.csdnimg.cn/20190306215730593.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaGFzdXN1,size_16,color_FFFFFF,t_70" alt="两变量卡诺图" /><figcaption>两变量卡诺图</figcaption></figure><p>三变量卡诺图：</p><p><img src="https://img-blog.csdnimg.cn/20190306220010596.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaGFzdXN1,size_16,color_FFFFFF,t_70" /></p><p>逻辑函数<span class="math inline">\(F(A, B, C, D) = \sum m (0,1,2,5,7,8,10,11,14,15)\)</span>的卡诺图：</p><p><img src="https://img-blog.csdnimg.cn/20190306220704263.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaGFzdXN1,size_16,color_FFFFFF,t_70" /></p><h2 id="逻辑函数的卡诺图化简法">1.3 逻辑函数的卡诺图化简法</h2><p>诺图相邻性的特点保证了几何相邻两方格所代表的最小项只有一个变量不同。因此，若相邻的方格都为1（简称1格）时，则对应的最小项就可以合并。合并的结果是消去这个不同的变量，只保留相同的变量。这是图形化简法的依据。</p><p>综上所述，卡诺图具备以下特性：</p><ol type="1"><li>卡诺图中两个相邻1格的最小项可以合并成一个与（加）项，并消去一个变量。</li><li>卡诺图中四个相邻1格的最小项可以合并成一个与（加）项，并消去两个变量。</li><li>卡诺图中八个相邻1格的最小项可以合并成一个与（加）项，并消去三个变量。</li></ol><p>利用这3点特性来接着看下面的例子：</p><p><img src="https://img-blog.csdnimg.cn/20190306221517963.png" /></p><p>上图两个相邻1格的最小项可以合并成一个与项，并消去一个变量，化简式子如下：</p><p><span class="math display">\[m_1 = m_5 = \overline{A}\overline{B}C + A\overline{B}C = (\overline{A} + A)\overline{B}C = \overline{B}C\]</span></p><p>根据上面3个特性再来看几个例子加深理解，以下是4个相邻1格的： <img src="https://img-blog.csdnimg.cn/20190306222100667.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2hhaGFzdXN1,size_16,color_FFFFFF,t_70" /></p><p><strong>Example:</strong></p><p><span class="math display">\[F(A,B,C) = \sum(1,2,3,6,7)\]</span></p><p>先画出卡诺图，然后转换十进制对应1,2,3,6,7的地方填入为1，其余填写为0（这个步骤有前面的知识点支撑，应该不难理解了。）</p><p><img src="https://img-blog.csdnimg.cn/20190306224020999.png" /></p><p>然后获得式子：<span class="math inline">\(F = (m_1 + m_3) + (m_2 + m_3 + m_6 + m_7)\)</span></p><p>即：</p><p><span class="math display">\[F = \overline{A}C + B\]</span></p><p>首先，有这么几点需要明确：</p><ol type="1"><li>列出逻辑函数的最小项表达式，由最小项表达式确定变量的个数（如果最小项中缺少变量，应按例的方法补齐）。</li><li>画出最小项表达式对应的卡诺图。</li><li>将卡诺图中的1格画圈，一个也不能漏圈，否则最后得到的表达式就会与所给函数不等；1格允许被一个以上的圈所包围。</li><li>圈的个数应尽可能得少。即在保证1格一个也不漏圈的前提下，圈的个数越少越好。因为一个圈和一个与项相对应，圈数越少，与或表达式的与项就越少。</li><li>按照2k个方格来组合（即圈内的1格数必须为1，2，4，8等），圈的面积越大越好。因为圈越大，可消去的变量就越多，与项中的变量就越少。</li><li>每个圈应至少包含一个新的1格，否则这个圈是多余的。</li><li>用卡诺图化简所得到的最简与或式不是唯一的。</li></ol><h2 id="reference">Reference</h2><p><a href="https://blog.csdn.net/hahasusu/article/details/88244155">https://blog.csdn.net/hahasusu/article/details/88244155</a></p>]]></content>
    
    
    <categories>
      
      <category>Electronic Design Automation</category>
      
      <category>Logic Synthesis</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Design Pattern</title>
    <link href="/Programming/Python/Design%20Pattern/"/>
    <url>/Programming/Python/Design%20Pattern/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="一面向对象设计原则">一、面向对象设计原则</h1><h2 id="依赖倒置原则dip">依赖倒置原则（DIP）</h2><ul><li>高层模块（稳定）不应该依赖（编译时依赖）于底层模块（变化），二者都应该依赖于抽象（稳定）。</li><li>抽象（稳定）不应该依赖于实现细节（变化），实现细节应该依赖于抽象（稳定）。</li></ul><h2 id="开放封闭原则">开放封闭原则</h2><ul><li>对拓展开放，对更改封闭</li><li>类模块是可扩展的，但是不可修改。</li></ul><h2 id="单一职责原则srp">单一职责原则（SRP）</h2><ul><li>一个类应该仅有一个引起它变化的原因。</li><li>变化的方向隐含着类的责任。</li></ul><h2 id="liskov替换原则lsp">Liskov替换原则（LSP）</h2><ul><li>子类必须能够替换它们的基类（IS-A）。</li><li>继承表达类型抽象</li></ul><h2 id="接口隔离原则isp">接口隔离原则（ISP）</h2><ul><li>不应该强迫客户程序依赖它们不用的方法。</li><li>接口应该小而完备。</li></ul><h2 id="优先使用组合而不是继承">优先使用组合而不是继承</h2><ul><li>类继承通常为“白箱复用”，对象组合通常为“黑箱复用”。</li><li>继承在某种程度上破坏了封装性，子类父类耦合度高。</li><li>对象组合则只要求被组合的对象具有良好的定义的接口，耦合度低。</li></ul><h2 id="封装变化点">封装变化点</h2><ul><li>使用封装来创建对象之间的分界层，让设计者可以对分界层的一侧进行修改，而不会对另一侧产生不良的影响，从而实现层次间的松耦合。</li></ul><h2 id="针对接口编程而不是针对实现编程">针对接口编程，而不是针对实现编程</h2><ul><li>不将变量类型声明为某个特定的具体类，而是声明为某个接口。</li><li>客户程序无需获知对象的具体类型，只需要知道对象所具有的接口。</li><li>减少系统中各部分的依赖关系，从而实现“高内聚、松耦合”的类型设计方案。</li></ul><h1 id="二模板方法">二、模板方法</h1><p><strong>Motivation：</strong> 如何在确定稳定操作结构的前提下，灵活应对各个子步骤的变化或者晚期实现需求？</p><p><strong>Definition：</strong> 定义一个操作中的算法骨架（稳定），而将一些步骤延迟（变化）到子类中。Template Method使得子类可以不改变（复用）一个算法的结构即可重定义overeide该算法的某些特定步骤。</p><p>Case1:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lib</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step1</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step3</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step5</span><span class="hljs-params">()</span></span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">step2</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step4</span><span class="hljs-params">()</span></span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    <span class="hljs-function">Lib <span class="hljs-title">lib</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-function">App <span class="hljs-title">app</span><span class="hljs-params">()</span></span>;<br>    lib.<span class="hljs-built_in">step1</span>();<br>    <span class="hljs-keyword">if</span>(app.<span class="hljs-built_in">step2</span>()) &#123;<br>        lib.<span class="hljs-built_in">step3</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++ i) &#123;<br>        app.<span class="hljs-built_in">step4</span>();<br>    &#125;<br>        lib.<span class="hljs-built_in">step5</span>();<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>Case2:</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Lib</span>&#123;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-comment">// Stable template method</span><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">run</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-built_in">step1</span>();<br>        <span class="hljs-keyword">if</span>(<span class="hljs-built_in">step2</span>()) &#123;  <span class="hljs-comment">// Support for changes due to Polymorphism</span><br>            <span class="hljs-built_in">step3</span>();<br>        &#125;<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; ++ i) &#123;<br>            <span class="hljs-built_in">step4</span>();  <span class="hljs-comment">// Support for changes due to Polymorphism</span><br>        &#125;<br>            <span class="hljs-built_in">step5</span>();<br>    &#125;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Lib</span>()&#123;&#125;<br><br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step1</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step3</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">step5</span><span class="hljs-params">()</span></span>&#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">step2</span><span class="hljs-params">()</span></span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">step4</span><span class="hljs-params">()</span></span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">App</span> : <span class="hljs-keyword">public</span> Lib&#123;<br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">bool</span> <span class="hljs-title">step2</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">step4</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span>&#123;<br>    Lib* lib = <span class="hljs-keyword">new</span> <span class="hljs-built_in">App</span>();<br>    lib-&gt;<span class="hljs-built_in">run</span>();<br>    <span class="hljs-keyword">delete</span> lib;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Conclution:</strong><br />- Make it a habit to recognize which function is variable and which is stable. - Template method is common. - The virtual functions are often set to protected.</p><h1 id="三策略模式">三、策略模式</h1><p><strong>Motivaiton：</strong> 某些对象的算法可能多种多样，经常改变，如果将这些算法都编码到对象中，将会使的对象很复杂。</p><p><strong>Definition:</strong> 定义一系列算法，把它们一个个封装起来，并且使它们可以互相替换（变化）。该模式使得算法可以独立于使用它的客户程序（稳定）而变化（拓展，子类化）。</p><p><strong>Case1</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">enum</span> <span class="hljs-title class_">TaxBase</span> &#123;<br>    CN_Tax,<br>    US_Tax,<br>    DE_Tax,<br>    <span class="hljs-comment">// change: TR_Tax</span><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SalesOrder</span>&#123;<br>    TaxBase tax;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">CalculateTax</span><span class="hljs-params">()</span></span>&#123;<br>        <span class="hljs-keyword">if</span> (tax == CN_Tax) &#123;&#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tax == US_Tax) &#123;&#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (tax == DE_Tax) &#123;&#125;<br>        <span class="hljs-comment">// change: else if (tax == FR_Tax) &#123;&#125;</span><br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Case2</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">TaxStrategy</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">Calculate</span><span class="hljs-params">(<span class="hljs-type">const</span> Context&amp; context)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">TaxStrategy</span>() &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CNTax</span> : <span class="hljs-keyword">public</span> TaxStrategy &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">Calculate</span><span class="hljs-params">(<span class="hljs-type">const</span> Context&amp; context)</span> </span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">USTax</span> : <span class="hljs-keyword">public</span> TaxStrategy &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">Calculate</span><span class="hljs-params">(<span class="hljs-type">const</span> Context&amp; context)</span> </span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">DETax</span> : <span class="hljs-keyword">public</span> TaxStrategy &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">double</span> <span class="hljs-title">Calculate</span><span class="hljs-params">(<span class="hljs-type">const</span> Context&amp; context)</span> </span>&#123;&#125;<br>&#125;;<br><br><span class="hljs-comment">// extend:</span><br><span class="hljs-comment">// class FRTax : public TaxStrategy &#123;</span><br><span class="hljs-comment">// public:</span><br><span class="hljs-comment">//     virtual double Calculate(const Context&amp; context) &#123;&#125;</span><br><span class="hljs-comment">// &#125;;</span><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SalesOrder</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    TaxStrategy* strategy;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">SalesOrder</span>(StrategyFactory* strategyFactory) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;strategy = strategyFactory-&gt;<span class="hljs-built_in">NewStrategy</span>();<br>    &#125;<br>    ~<span class="hljs-built_in">SalesOrder</span>()&#123;<br>        <span class="hljs-keyword">delete</span> <span class="hljs-keyword">this</span>-&gt;strategy;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">double</span> <span class="hljs-title">CalculateTax</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-function">Context <span class="hljs-title">conttext</span><span class="hljs-params">()</span></span>;<br>        <br>        <span class="hljs-type">double</span> val = strategy-&gt;<span class="hljs-built_in">Calculate</span>(context);<br>    &#125; <br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong></p><ul><li>Strategy pattern provides a series of re-used algorithms to make switching alogrithms more convenient.</li><li>Strategy pattern can substitude condition statement unless the conditions are countable.</li><li>Single instance pattern can be used to reduce overhead</li></ul><h1 id="四观察者模式">四、观察者模式</h1><p><strong>Motivation：</strong> - 为某些对象简历通知依赖关系，即，一个对象的状态发生改变，所有的依赖对象都将得到通知。如果这样的依赖关系过于紧密，将使软件不能很好地抵御变化。 - 使用面向对象技术，可以将这种依赖关系弱化，并形成一种稳定的依赖关系，从而实现软件体系结构的松耦合。</p><p><strong>Definition:</strong> 定义对象间的一对多（变化）的依赖关系，以便当一个对象的状态发生改变时，所有依赖于它的对象都得到通知并自动更新。</p><p><strong>Case1:</strong> Betray DIP, and the progressBar might be changed with aternaltive form in the future.</p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSplitter</span> &#123;<br>    string m_filePath;<br>    <span class="hljs-type">int</span> m_fileNumber;<br>    ProgressBar* m_progressBar;  <span class="hljs-comment">// New requirement</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">FileSplitter</span>(<span class="hljs-type">const</span> string &amp; filePath, <span class="hljs-type">int</span> fileNumber, ProgressBar* progressBar) :<br>        <span class="hljs-built_in">m_filePath</span>(filePath),<br>        <span class="hljs-built_in">m_fileNumber</span>(fileNumber),<br>        <span class="hljs-built_in">m_progressBar</span>(progressBar) &#123;&#125;<br>        <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 1. 读取大文件</span><br><br>        <span class="hljs-comment">// 2.分批次向小文件写入</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_fileNumber; ++i) &#123;<br>            <span class="hljs-comment">// ...</span><br>            <span class="hljs-keyword">if</span> (m_progressBar) &#123;<br>                m_progressBar-&gt;<span class="hljs-built_in">setValue</span>((i + <span class="hljs-number">1</span>) / m_fileNumber);  <span class="hljs-comment">// Update progressbar</span><br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainForm</span> : <span class="hljs-keyword">public</span> Form<br>&#123;<br>    TextBox* txtFilePath;<br>    TextBox* txtFileNumber;<br>    ProgressBar* progressBar;  <span class="hljs-comment">// New requirement</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Button1_Click</span><span class="hljs-params">()</span> </span>&#123;<br>        string filePath = txtFilePath-&gt;<span class="hljs-built_in">getText</span>();<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">atoi</span>(txtFileNumber-&gt;<span class="hljs-built_in">getText</span>().<span class="hljs-built_in">c_str</span>());<br><br>         <span class="hljs-function">FileSplitter <span class="hljs-title">splitter</span><span class="hljs-params">(filePath, number, progressBar)</span></span>;<br>        splitter.<span class="hljs-built_in">split</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Case2:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-comment">// Observer</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IProgress</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoProgress</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">IProgress</span>()&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSplitter</span> &#123;<br>    string m_filePath;<br>    <span class="hljs-type">int</span> m_fileNumber;<br>    <span class="hljs-comment">// ProgressBar* m_progressBar;  </span><br>    list&lt;IProgress*&gt;  m_iprogressList;  <span class="hljs-comment">// 抽象通知机制，支持多个观察者</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">FileSplitter</span>(<span class="hljs-type">const</span> string &amp; filePath, <span class="hljs-type">int</span> fileNumber) :<br>        <span class="hljs-built_in">m_filePath</span>(filePath),<br>        <span class="hljs-built_in">m_fileNumber</span>(fileNumber) &#123;&#125;<br>        <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">add_IProgress</span><span class="hljs-params">(IProgress* iprogress)</span> </span>&#123;<br>        m_iprogressList.<span class="hljs-built_in">add</span>(iprogress);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">remove_IProgress</span><span class="hljs-params">(IProgress* iprogress)</span> </span>&#123;<br>        m_iprogressList.<span class="hljs-built_in">remove</span>(iprogress);<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-comment">// 1. 读取大文件</span><br><br>        <span class="hljs-comment">// 2.分批次向小文件写入</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; m_fileNumber; ++i) &#123;<br>                <span class="hljs-comment">// ...</span><br>                <span class="hljs-type">float</span> progressValue = m_fileNumber;<br>                progressValue = (i + <span class="hljs-number">1</span>) / progressValue;<br>                <span class="hljs-built_in">onProgress</span>(progressValue);  <span class="hljs-comment">// 发送通知</span><br>            &#125;<br>        &#125;<br>        <br><span class="hljs-keyword">protected</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">onProgress</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span> </span>&#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">auto</span> &amp;iter : m_iprogressList) &#123;<br>            iter-&gt;<span class="hljs-built_in">DoProgress</span>(progressValue);  <span class="hljs-comment">// Update progressbar</span><br>        &#125;<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainForm</span> : <span class="hljs-keyword">public</span> Form, <span class="hljs-keyword">public</span> IProgress  <span class="hljs-comment">// C++ 多继承一般第一个是父类，其他的是接口</span><br>&#123;<br>    TextBox* txtFilePath;<br>    TextBox* txtFileNumber;<br>    ProgressBar* progressBar;  <span class="hljs-comment">// New requirement</span><br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Button1_Click</span><span class="hljs-params">()</span> </span>&#123;<br>        string filePath = txtFilePath-&gt;<span class="hljs-built_in">getText</span>();<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">atoi</span>(txtFileNumber-&gt;<span class="hljs-built_in">getText</span>().<span class="hljs-built_in">c_str</span>());<br><br>        ConsoleNotifier cn;<br>        <br>        <span class="hljs-function">FileSplitter <span class="hljs-title">splitter</span><span class="hljs-params">(filePath, number)</span></span>;<br><br>        splitter.<span class="hljs-built_in">addIProgress</span>(<span class="hljs-keyword">this</span>);  <span class="hljs-comment">// 订阅通知</span><br>        splitter.<span class="hljs-built_in">addIProgress</span>(&amp;cn);  <span class="hljs-comment">// 订阅通知</span><br><br>        splitter.<span class="hljs-built_in">split</span>();<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoProgress</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span> </span>&#123;<br>        progressBar-&gt;<span class="hljs-built_in">setValue</span>(value);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ConsoleNotifier</span> : <span class="hljs-keyword">public</span> IProgress &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DoProgress</span><span class="hljs-params">(<span class="hljs-type">float</span> value)</span> </span>&#123;<br>        cout &lt;&lt; <span class="hljs-string">&quot;.&quot;</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong></p><ul><li>We can change objective and observer separately with observer pattern to loosen coupling of objective and observer.</li><li>目标发送通知时，无需指定观察者，通知会自动传播。</li><li>观察者自己决定是否需要订阅通知，目标对象对此一无所知。</li></ul><h1 id="五装饰模式">五、装饰模式</h1><p><strong>Motivation:</strong> 过度使用继承来拓展对象的功能，由于继承为类型引入的静态特质，使得这种扩展方式缺乏灵活性；并且随着子类的增多，各种子类的组合会导致更多子类的膨胀。</p><p><strong>Definition:</strong> 动态（组合）地给一个对象增加一些额外的职责。就增加功能而言，Decorator模式比生成子类（继承）更为灵活（消除重复代码，减少子类个数）。</p><p><strong>Case1:</strong> <span class="math inline">\(1 + n + n * (2^m - 1)\)</span></p><p>其中<span class="math inline">\((2^m - 1) = C_m^1 + \cdots + C_m^m\)</span></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stream</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> </span>= <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-comment">// 拓展操作</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoFileStream</span> : <span class="hljs-keyword">public</span> FileStream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoNetworkStream</span> : <span class="hljs-keyword">public</span> NetworkStream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        NetworkStream::<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        NetworkStream::<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        NetworkStream::<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoMemoryStream</span> : <span class="hljs-keyword">public</span> MemoryStream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        MemoryStream::<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        MemoryStream::<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        MemoryStream::<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferedFileStream</span> : <span class="hljs-keyword">public</span> FileStream &#123;&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferedNetworkStream</span> : <span class="hljs-keyword">public</span> NetworkStream &#123;&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferedMemoryStream</span> : <span class="hljs-keyword">public</span> MemoryStream &#123;&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoBufferedFileStream</span> : <span class="hljs-keyword">public</span> FileSstream &#123;<br><span class="hljs-keyword">public</span>: <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        FileStream::<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-comment">// 编译时装配</span><br>    CryptoFileStream *fs1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CryptoFileStream</span>();<br>    BufferedFileStream *fs2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BufferedFileStream</span>();<br>    CryptoBufferedFileStream *fs3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CryptoBufferedFileStream</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Case2:</strong> <span class="math inline">\(1 + n + 1 + m\)</span></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stream</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">int</span> data)</span> </span>= <span class="hljs-number">0</span>;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">NetworkStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MemoryStream</span> : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(<span class="hljs-type">char</span> data)</span> </span>&#123;&#125;<br>&#125;; <br><br><span class="hljs-comment">// 拓展操作</span><br><br>DecoratorStream : <span class="hljs-keyword">public</span> Stream &#123;<br><span class="hljs-keyword">protected</span>:<br>    Stream* stream;<br><br>    <span class="hljs-built_in">DecoratorStream</span>(Stream * stm) : <span class="hljs-built_in">stream</span>(stm) &#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">CryptoStream</span> : <span class="hljs-keyword">public</span> DecoratorStream &#123;  <span class="hljs-comment">// 继承为了接口规范</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">CryptoStream</span>(Stream *stm): <span class="hljs-built_in">DecoratorStream</span>(stm) &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BufferedStream</span> : <span class="hljs-keyword">public</span> DecoratorStream &#123;  <span class="hljs-comment">// 继承为了接口规范</span><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-built_in">BufferedStream</span>(Stream *stm): <span class="hljs-built_in">DecoratorStream</span>(stm) &#123;&#125;<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Read</span><span class="hljs-params">(<span class="hljs-type">int</span> number)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Read</span>(number);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Seek</span><span class="hljs-params">(<span class="hljs-type">int</span> position)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Seek</span>(position);<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">char</span> <span class="hljs-title">Write</span><span class="hljs-params">(byte data)</span> </span>&#123;<br>        stream-&gt;<span class="hljs-built_in">Write</span>(data);<br>    &#125;<br>&#125;; <br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span> </span>&#123;<br><br>    <span class="hljs-comment">// 运行时装配</span><br>    FileStream* s1 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FileStream</span>();<br>    CryptoStream* s2 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">CryptoStream</span>(s1);<br>    BufferedSteam1* s3 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BufferedStream</span>(s1);<br>    BufferedSteam1* s4 = <span class="hljs-keyword">new</span> <span class="hljs-built_in">BufferedStream</span>(s2);  <span class="hljs-comment">// CryptoBufferedStream</span><br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong> - 通过组合而非继承的方法，实现了运行时动态扩展对象功能的能力</p><h1 id="六桥模式">六、桥模式</h1><p><strong>Motivation：</strong> 由于某些类型的固有实现逻辑，使得它们具有两个变化的维度，乃至多个维度的变化。</p><p><strong>Definition:</strong> 将抽象部分与实现部分分离，使他们都可以独立地变化。</p><p><strong>Case1: <span class="math inline">\(1 + n + m * n\)</span></strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Messager</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Messager</span>()&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PCMessagerBase</span> : <span class="hljs-keyword">public</span> Messager &#123;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MobileMessagerBase</span> : <span class="hljs-keyword">public</span> Messager &#123;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>&#125;<br><br><span class="hljs-comment">// 业务抽象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PCMessagerLite</span> : <span class="hljs-keyword">public</span> PCMessagerBase &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PCMessagerPerfect</span> : <span class="hljs-keyword">public</span> PCMessagerBase &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        PCMessagerBase::<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        PCMessagerBase::<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        PCMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        PCMessagerBase::<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MobileMessagerLite</span> : <span class="hljs-keyword">public</span> MobileMessagerBase &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MobileMessagerPerfect</span> : <span class="hljs-keyword">public</span> MobileMessagerBase &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        MobileMessagerBase::<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        MobileMessagerBase::<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        MobileMessagerBase::<span class="hljs-built_in">PlaySound</span>();<br>        MobileMessagerBase::<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span></span>&#123;<br>    Messager *m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MobileMessagerPerfect</span>();<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Case2: <span class="math inline">\(1 + n + 1 + m\)</span></strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Messager</span> &#123;<br><span class="hljs-keyword">protected</span>:<br>    MessagerImp* messagerImp;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>= <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">Messager</span>()&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagerImp</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br><br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">MessagerImp</span>()&#123;&#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PCMessagerImp</span> : <span class="hljs-keyword">public</span> MessagerImp &#123;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MobileMessagerImp</span> : <span class="hljs-keyword">public</span> MessagerImp &#123;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">PlaySound</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">DrawShape</span><span class="hljs-params">()</span> </span>&#123;&#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">WriteText</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Connect</span><span class="hljs-params">()</span> </span>&#123;&#125;;<br>&#125;<br><br><span class="hljs-comment">// 业务抽象</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagerLite</span> : <span class="hljs-keyword">public</span> Messager &#123;<br>    <br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MessagerPerfect</span> : <span class="hljs-keyword">public</span> Messager &#123;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">Login</span><span class="hljs-params">(string username, string password)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">PlaySound</span>();<br>        messagerImp-&gt;<span class="hljs-built_in">Connect</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendMessage</span><span class="hljs-params">(string message)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">PlaySound</span>();<br>        messagerImp-&gt;<span class="hljs-built_in">WriteText</span>();<br>    &#125;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">SendPicture</span><span class="hljs-params">(Image image)</span> </span>&#123;<br>        messagerImp-&gt;<span class="hljs-built_in">PlaySound</span>();<br>        messagerImp-&gt;<span class="hljs-built_in">DrawShape</span>();<br>    &#125;;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span></span>&#123;<br>    MessagerImp *mImp = <span class="hljs-keyword">new</span> <span class="hljs-built_in">PCMessagerImp</span>();<br>    Messager *m = <span class="hljs-keyword">new</span> <span class="hljs-built_in">MessagerPerfect</span>(mImp);<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong></p><ul><li>Bridege pattern 使用对象间的组合关系解耦合了抽象和实现之间固有的绑定关系，使得抽象和实现可以沿着各自的维度来变化.</li></ul><h1 id="七工厂方法模式">七、工厂方法模式</h1><p><strong>Motivation：</strong></p><ul><li><p>在软件系统中，经常面临着创建对象的工作，由于需求的变化，需要创建的对象的具体类型经常变化。</p></li><li><p>绕过常规的对象创建方法（new），提供一种封装机制来避免客户程序和具体对象创建工作的紧耦合。</p></li></ul><p><strong>Definition:</strong> 将抽象部分与实现部分分离，使他们都可以独立地变化。</p><p><strong>Case1:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ISplitter</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">ISplitter</span>()&#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><span class="hljs-keyword">public</span>: <br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>&#123;<br><br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BinarySplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TxtSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PictureSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainForm</span> : <span class="hljs-keyword">public</span> Form<br>&#123;<br><br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Button1_Click</span><span class="hljs-params">()</span> </span>&#123;<br>        string filePath = txtFilePath-&gt;<span class="hljs-built_in">getText</span>();<br>        <span class="hljs-type">int</span> number = <span class="hljs-built_in">atoi</span>(txtFileNumber-&gt;<span class="hljs-built_in">getText</span>().<span class="hljs-built_in">c_str</span>());<br><br>        ISplitter * splitter = <span class="hljs-keyword">new</span> <span class="hljs-built_in">FileSplitter</span>(filePath, number);  <span class="hljs-comment">// 依赖具体类，这里写死了是FileSplitter，违反依赖导致原：抽象（稳定）不应该依赖于实现细节（变化），实现细节应该依赖于抽象（稳定）。</span><br>        splitter-&gt;<span class="hljs-built_in">split</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Case2:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">SplitterFactory</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">CreateSplitter</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">SplitterFactory</span>() &#123;&#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">ISplitter</span>&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">ISplitter</span>()&#123;&#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BinarySplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TxtSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PictureSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br><br>&#125;;<br><br><span class="hljs-comment">// 具体工厂</span><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BinarySplitterFactory</span>: <span class="hljs-keyword">public</span> SplitterFactory &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">CreateSplitter</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">BinarySplitter</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TxtSplitterFactory</span>: <span class="hljs-keyword">public</span> SplitterFactory &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">CreateSplitter</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TxtSplitter</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PictureSplitterFactory</span>: <span class="hljs-keyword">public</span> SplitterFactory &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">CreateSplitter</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PictureSplitter</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VedioSplitterFactory</span>: <span class="hljs-keyword">public</span> SplitterFactory &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">CreateSplitter</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">VedioSplitter</span>();<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainForm</span> : <span class="hljs-keyword">public</span> Form<br>&#123;<br>    SplitterFactory* factory;<br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-built_in">MianForm</span>(SplitterFactory* factory) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;factory = factory;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Button1_Click</span><span class="hljs-params">()</span> </span>&#123;<br>        <br>        ISplitter* splitter = factory-&gt;<span class="hljs-built_in">CreateSplitter</span>();   <br>        splitter-&gt;<span class="hljs-built_in">split</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong></p><ul><li><p>Factory Method模式用于隔离类对象的使用者和具体类型之间的耦合关系。面对一个经常变化的具体类型，紧耦合关系会导致软件的脆弱。</p></li><li><p>Factory Method模式通过面向对象的手法，将所要创建的具体对象工作延迟到子类，从而实现一种扩展的策略，较好地解决了这种紧耦合关系。</p></li><li><p>Factory Method模式解决“单个对象”的需求变化。缺点在于要求创建方法/参数相同。</p></li></ul><h1 id="八抽象工厂模式">八、抽象工厂模式</h1><p><strong>Motivation:</strong> 在软件系统中，经常面临着<strong>一系列相互依赖的对象</strong>的创建工作；同时，由于需求的变化，往往存在更多系统对象的创建工作。</p><p><strong>Definition:</strong> 提供一个接口，让改接口负责创建一系列“相关或者相互依赖的对象”，无需指定他们具体的类。</p><p><strong>Case1:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">IBDConnection</span>&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDBConnectionFactory</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBConnection* <span class="hljs-title">CreateDBConnection</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDBCommand</span>&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDBCommandFactory</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBCommand* <span class="hljs-title">CreateDBCommand</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDataReader</span>&#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDataReaderFactory</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDataReader* <span class="hljs-title">CreateIDataReader</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlConnectionFactory</span>: <span class="hljs-keyword">public</span> IDBConnectionFactory&#123;<br><br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlConnection</span>: <span class="hljs-keyword">public</span> IDBConnection&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlCommandFactory</span>: <span class="hljs-keyword">public</span> IDBCommandFactory&#123;<br><br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlCommand</span>: <span class="hljs-keyword">public</span> IDBCommand&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlDataReaderFactory</span>: <span class="hljs-keyword">public</span> IDataReaderFactory&#123;<br><br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlDataReader</span>: <span class="hljs-keyword">public</span> IDataReader&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleConnection</span>: <span class="hljs-keyword">public</span> IDBConnection&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleCommand</span>: <span class="hljs-keyword">public</span> IDBCommand&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleDataReader</span>: <span class="hljs-keyword">public</span> IDataReader&#123;<br><br>&#125;;<br><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDAO</span>&#123;<br>    IDBConnectionFactory* dbConnectionFactory;<br>    IDBCommandFactory* dbCommandFactory;<br>    IDataReaderFactory* dataReaderFactory;                             <br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;EmployeeDO&gt; <span class="hljs-title">GetEmployees</span><span class="hljs-params">()</span></span>&#123;<br>        IDBConnection* connection = IDBConnectionFactory-&gt;<span class="hljs-built_in">createDBConnection</span>();<br>        connection-&gt;<span class="hljs-built_in">ConnectionString</span>(<span class="hljs-string">&quot;...&quot;</span>);<br><br>        IDBCommand* command = IDBCommandFactory-&gt;<span class="hljs-built_in">createDBCommand</span>();<br>        command-&gt;<span class="hljs-built_in">CommandText</span>(<span class="hljs-string">&quot;...&quot;</span>);<br>        command-&gt;<span class="hljs-built_in">SetConnection</span>(connection);  <span class="hljs-comment">// 关联性</span><br><br>        IDBDataReader* reader = command-&gt;<span class="hljs-built_in">ExecuteReader</span>(); <span class="hljs-comment">// 关联性</span><br>        <span class="hljs-keyword">while</span> (reader-&gt;<span class="hljs-built_in">Read</span>()) &#123;<br>                        <br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>case2:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IBDConnection</span>&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDBCommand</span>&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDataReader</span>&#123;<br><br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">IDBFactory</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBConnection* <span class="hljs-title">CreateDBConnection</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;    <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBCommand* <span class="hljs-title">CreateDBCommand</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDataReader* <span class="hljs-title">CreateIDataReader</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlDBFactory</span>: <span class="hljs-keyword">public</span> IDBFactory&#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBConnection* <span class="hljs-title">CreateDBConnection</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;    <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDBCommand* <span class="hljs-title">CreateDBCommand</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> IDataReader* <span class="hljs-title">CreateIDataReader</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>&#125; <br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlConnection</span>: <span class="hljs-keyword">public</span> IDBConnection&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlCommand</span>: <span class="hljs-keyword">public</span> IDBCommand&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SqlDataReader</span>: <span class="hljs-keyword">public</span> IDataReader&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleConnection</span>: <span class="hljs-keyword">public</span> IDBConnection&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleCommand</span>: <span class="hljs-keyword">public</span> IDBCommand&#123;<br><br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">OracleDataReader</span>: <span class="hljs-keyword">public</span> IDataReader&#123;<br><br>&#125;;<br><br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">EmployeeDAO</span>&#123;<br>    IDBFactory* dbFactory;<br>                           <br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function">vector&lt;EmployeeDO&gt; <span class="hljs-title">GetEmployees</span><span class="hljs-params">()</span></span>&#123;<br>        IDBConnection* connection = dbFactory-&gt;<span class="hljs-built_in">createDBConnection</span>();<br>        connection-&gt;<span class="hljs-built_in">ConnectionString</span>(<span class="hljs-string">&quot;...&quot;</span>);<br><br>        IDBCommand* command = dbFactory-&gt;<span class="hljs-built_in">createDBCommand</span>();<br>        command-&gt;<span class="hljs-built_in">CommandText</span>(<span class="hljs-string">&quot;...&quot;</span>);<br>        command-&gt;<span class="hljs-built_in">SetConnection</span>(connection);  <span class="hljs-comment">// 关联性</span><br><br>        IDBDataReader* reader = command-&gt;<span class="hljs-built_in">ExecuteReader</span>(); <span class="hljs-comment">// 关联性</span><br>        <span class="hljs-keyword">while</span> (reader-&gt;<span class="hljs-built_in">Read</span>()) &#123;<br>                        <br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong> - 如果没有应对“多系列对象构建”的需求变化，则没有必要使用Abstract Factory模式，这时候使用简单的工厂完全可以。</p><ul><li><p>“系列对象”指的是在某一特定系列下的对象之间有相互依赖、或作用的关系。不同系列对象之间不能相互依赖。</p></li><li><p>Abstract Factory模式主要在于应对“新系列”的需求变动。其缺点在于难以应对“新对象”的需求变动。</p></li></ul><h1 id="原型模式">原型模式</h1><p><strong>Motivation:</strong> 在软件系统中，经常面临着“某些结构复杂的对象”的创建工作；由于需求的变化，这些对象经常面临着剧烈的变化，但是它们却拥有比较稳定一致的接口。</p><p><strong>Definition:</strong> 使用原型实例指定创建对象的种类，然后通过拷贝这些原型来创建新的对象。</p><p><strong>case 2:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ISplitter</span> &#123;<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>; <br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> <span class="hljs-type">void</span> <span class="hljs-title">split</span><span class="hljs-params">()</span> </span>= <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">virtual</span> ~<span class="hljs-built_in">ISplitter</span>()&#123;&#125;<br>&#125;;<br><br><br><span class="hljs-comment">// 具体类</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BinarySplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">BinarySplitter</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TxtSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">TxtSplitter</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PictureSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">PictureSplitter</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">VideoSplitter</span> : <span class="hljs-keyword">public</span> ISplitter&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">virtual</span> ISplitter* <span class="hljs-title">clone</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">VideoSplitter</span>(*<span class="hljs-keyword">this</span>);<br>    &#125;<br>&#125;;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MainForm</span> : <span class="hljs-keyword">public</span> Form<br>&#123;<br>    ISplitter* prototype;  <span class="hljs-comment">// 原型对象</span><br><span class="hljs-keyword">public</span>:<br><br>    <span class="hljs-built_in">MianForm</span>(ISplitter* prototype) &#123;<br>        <span class="hljs-keyword">this</span>-&gt;prototype = prototype;<br>    &#125;<br><br>    <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Button1_Click</span><span class="hljs-params">()</span> </span>&#123;<br>        <br>        ISplitter* splitter = prototype-&gt;<span class="hljs-built_in">clone</span>(); <span class="hljs-comment">// 克隆原型  </span><br>        splitter-&gt;<span class="hljs-built_in">split</span>();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong> - 什么时候用原型什么时候用工厂？用工厂模式创建对象是否是几个简单的步骤就能创建出来，还是说要考虑对象复杂的中间状态。 - 原型模式同样用于隔离类对象的使用者和具体类型（易变类）之间的耦合关系，它同样要求这些“易变类”拥有“稳定的接口”。 - 原型模式对于“如何创建易变类的实体对象”采用“原型克隆”的方法来做，它使得我们可以非常灵活地动态创建“拥有某些稳定接口”的新对象--所需工作仅仅是注册一个新类的对象（即原型），然后再任何需要的地方Clone。 - 原型模式中的Clone方法可以利用某些框架中的序列化来实现深拷贝。</p><h1 id="构建器">构建器</h1><p><strong>Motivation:</strong> 在软件系统中，有时候面临着“一个复杂对象”的创建工作，其通常由各个部分的子对象用一定的算法构成；由于需求的变化，这个复杂对象的各个部分经常面临着剧烈的变化，但是将它们组合在一起的算法却相对稳定。</p><h1 id="单例模式">单例模式</h1><p><strong>Motivation:</strong></p><ul><li><p>在软件系统中，经常有一些特殊的类，必须保证它们在系统中只存在一个实例，才能确保它们的逻辑正确性、以及良好的效率。</p></li><li><p>如何绕过常规的构造器，提供一种机制保证一个类只有一个实例</p></li></ul><p><strong>Definition:</strong> 使用原型实例指定创建对象的种类，然后通过拷贝这些原型来创建新的对象。</p><p><strong>Case1:</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Singleton</span> &#123;<br><span class="hljs-keyword">private</span>:<br>    <span class="hljs-built_in">Singleton</span>();<br>    <span class="hljs-built_in">Singleton</span>(<span class="hljs-type">const</span> Singlton&amp; other);<br><span class="hljs-keyword">public</span>:<br>    <span class="hljs-function"><span class="hljs-type">static</span> Singleton* <span class="hljs-title">getInstance</span><span class="hljs-params">()</span></span>;<br>    <span class="hljs-type">static</span> Singleton* m_instance;    <br>&#125;<br><br>Singleton* Singleton::m_instance = <span class="hljs-literal">nullptr</span>;<br><br><span class="hljs-comment">// MT non-safe</span><br><span class="hljs-function">Sington* <span class="hljs-title">Singleton::getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!m_instance) m_instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Singleton</span>();<br>    <span class="hljs-keyword">return</span> m_instnace;<br>&#125;<br><br><span class="hljs-comment">// MT safe</span><br><span class="hljs-function">Sington* <span class="hljs-title">Singleton::getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>    Lock lock;<br>    <span class="hljs-keyword">if</span> (!m_instance) m_instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Singleton</span>();<br>    <span class="hljs-keyword">return</span> m_instnace;<br>&#125;<br><br><span class="hljs-comment">// double-check lock while reordering non-safe</span><br><span class="hljs-function">Sington* <span class="hljs-title">Singleton::getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">if</span> (!m_instance) &#123;<br>        Lock lock;<br>        <span class="hljs-keyword">if</span> (!m_instance) m_instance = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Singleton</span>();<br>    &#125;<br>    <span class="hljs-keyword">return</span> m_instnace;<br>&#125;<br><br><span class="hljs-comment">// C++ 11 volatile</span><br><br>std::atomic&lt;Singleton*&gt; Singleton::m_instance;<br>std::mutex Singtle::m_mutex;<br><br><span class="hljs-function">Singleton* <span class="hljs-title">Singleton::getInstance</span><span class="hljs-params">()</span> </span>&#123;<br>    Singleton* tmp = m_instance.<span class="hljs-built_in">load</span>(std::memory_order_relaxed);<br>    std::<span class="hljs-built_in">atomic_thread_fence</span>(std::memory_order_acquire);  <span class="hljs-comment">// acquire fence</span><br>    <span class="hljs-keyword">if</span> (tmp == nulpptr) &#123;<br>        <span class="hljs-function">std::lock_guard&lt;std::mutex&gt; <span class="hljs-title">lock</span><span class="hljs-params">(m_mutex)</span></span>;<br>        tmp = m_instance.<span class="hljs-built_in">load</span>(std::memory_oder_relaxed);<br>        <span class="hljs-keyword">if</span> (tmp == <span class="hljs-literal">nullptr</span>) &#123;<br>            tmp = <span class="hljs-keyword">new</span> Singleton;<br>            std::<span class="hljs-built_in">atomic_thread_fence</span>(std::memory_order_release); <span class="hljs-comment">// release fence</span><br>            m_instance.<span class="hljs-built_in">store</span>(tmp, std::memory_order_relaxed);<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p><strong>Conclusion:</strong></p><ul><li><p>Singleton模式中的实例构造器可以设置为protected</p></li><li><p>Singleton模式一般不要支持拷贝构造函数，因为有可能导致多个对象实例</p></li><li><p>多线程下安全的Singleton</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>My Vim Cheat Sheet</title>
    <link href="/Programming/Python/Vim%20Cheat%20Sheet/"/>
    <url>/Programming/Python/Vim%20Cheat%20Sheet/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="cursor-movement">Cursor movement</h1><p><strong>i:</strong> move cursor up</p><p><strong>k:</strong> move cursor down</p><p><strong>j:</strong> move cursor left</p><p><strong>l:</strong> move cursor right</p><p><strong>I:</strong> move cursor up 5 lines</p><p><strong>K:</strong> move cursor down 5 lines</p><p><strong>J:</strong> move cursor left 5 characters</p><p><strong>L:</strong> move cursor right 5 characters</p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>VSCode Configuration</title>
    <link href="/Programming/Python/VSCode%20Configuration/"/>
    <url>/Programming/Python/VSCode%20Configuration/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><!-- TOC --><ul><li><a href="#hotkey">Hotkey</a><ul><li><a href="#general">General</a></li><li><a href="#basic-editing">Basic editing</a></li><li><a href="#navigation">Navigation</a></li><li><a href="#editor-management">Editor management</a></li><li><a href="#rich-languages-editing">Rich languages editing</a></li><li><a href="#file-management">File management</a></li><li><a href="#display">Display</a></li><li><a href="#debug">Debug</a></li><li><a href="#integrated-terminal">Integrated terminal</a></li><li><a href="#bookmark">BookMark</a></li></ul></li><li><a href="#cc">C/C++</a></li><li><a href="#vim">Vim</a></li></ul><!-- /TOC --><!-- /TOC --><!-- /TOC --><h1 id="hotkey">Hotkey</h1><h2 id="general">General</h2><table><tbody><tr class="odd"><td>Ctrl+Shift+P</td><td>Show command palette</td></tr><tr class="even"><td>Ctrl+P</td><td>Quick Open</td></tr><tr class="odd"><td>Ctrl+Shift+N</td><td>New window</td></tr><tr class="even"><td>Ctrl+Shift+W</td><td>Close window</td></tr></tbody></table><h2 id="basic-editing">Basic editing</h2><table><tbody><tr class="odd"><td>Ctrl+Shift+[</td><td>Fold region</td></tr><tr class="even"><td>Ctrl+Shift+]</td><td>Unfold region</td></tr><tr class="odd"><td>Ctrl+K+Ctrl+[</td><td>Fold all subregions</td></tr><tr class="even"><td>Ctrl+K+Ctrl+]</td><td>Unfold all subregions</td></tr></tbody></table><h2 id="navigation">Navigation</h2><table><tbody><tr class="odd"><td>Alt+<span class="math inline">\(\leftarrow\)</span></td><td>Navigate back</td></tr><tr class="even"><td>Alt+<span class="math inline">\(\rightarrow\)</span></td><td>Navigate forward</td></tr></tbody></table><h2 id="editor-management">Editor management</h2><table><tbody><tr class="odd"><td>Ctrl+W</td><td>Close editor</td></tr><tr class="even"><td>Ctrl+\</td><td>Split editor</td></tr><tr class="odd"><td>Ctrl+1/2/3</td><td>Focus into 1st, 2nd or 3rd editor group</td></tr><tr class="even"><td>Ctrl+K+Ctrl+<span class="math inline">\(\leftarrow\)</span> / <span class="math inline">\(\rightarrow\)</span></td><td>Focus into left/right editor group</td></tr><tr class="odd"><td>Ctrl+Alt+Z</td><td>Focus into next editor group</td></tr><tr class="even"><td>Ctrl+Shift+PgUp/PgDown</td><td>Move editor left/right</td></tr><tr class="odd"><td>Ctrl+K+<span class="math inline">\(\leftarrow\)</span> / <span class="math inline">\(\rightarrow\)</span></td><td>Move active editor group</td></tr><tr class="even"><td>Ctrl+Alt+<span class="math inline">\(\rightarrow\)</span></td><td>Move to next editor group</td></tr><tr class="odd"><td>Ctrl+Alt+<span class="math inline">\(\leftarrow\)</span></td><td>Move to previous editor group</td></tr></tbody></table><h2 id="rich-languages-editing">Rich languages editing</h2><table><tbody><tr class="odd"><td>Shift+Alt+F</td><td>Format document</td></tr></tbody></table><h2 id="file-management">File management</h2><table><tbody><tr class="odd"><td>Ctrl+Tab</td><td>Open next</td></tr><tr class="even"><td>Ctrl+Shift+Tab</td><td>Open previous</td></tr><tr class="odd"><td>Ctrl+K+P</td><td>Copy path of active file</td></tr><tr class="even"><td>Ctrl+N</td><td>New file</td></tr><tr class="odd"><td>Ctrl+O</td><td>Open file</td></tr><tr class="even"><td>Shift+Alt+C</td><td>Copy path of active file</td></tr></tbody></table><h2 id="display">Display</h2><table><tbody><tr class="odd"><td>Ctrl+Shift+Q</td><td>Show Explorer</td></tr><tr class="even"><td>Ctrl+Shift+F</td><td>Show Search</td></tr><tr class="odd"><td>Ctrl+Shift+G G</td><td>Show Git</td></tr><tr class="even"><td>Ctrl+Shift+D</td><td>Show Debug</td></tr><tr class="odd"><td>Ctrl+K+V</td><td>Open Markdown preview to the side</td></tr><tr class="even"><td>Ctrl+Alt+X</td><td>Show Outline</td></tr></tbody></table><h2 id="debug">Debug</h2><table><tbody><tr class="odd"><td>F9</td><td>Toggle breakpoint</td></tr><tr class="even"><td>F5</td><td>Continue</td></tr><tr class="odd"><td>Shift+F5</td><td>Stop</td></tr><tr class="even"><td>F11/Shift F11</td><td>Step into/out</td></tr><tr class="odd"><td>F10</td><td>Step over</td></tr></tbody></table><h2 id="integrated-terminal">Integrated terminal</h2><table><tbody><tr class="odd"><td>Ctrl+`</td><td>Show integrated terminal</td></tr><tr class="even"><td>Ctrl+Shift+`</td><td>Create new terminal</td></tr><tr class="odd"><td>Ctrl+Shift+C</td><td>Copy selection</td></tr><tr class="even"><td>Ctrl+Shift+V</td><td>Paste into active terminal</td></tr><tr class="odd"><td>Ctrl+PgUp/PgDown</td><td>Focus on previous/next terminal group</td></tr><tr class="even"><td>Alt+Delete</td><td>Kill the active terminal instance</td></tr></tbody></table><h2 id="bookmark">BookMark</h2><table><tbody><tr class="odd"><td>Ctrl+ALT+K</td><td>Toggle</td></tr><tr class="even"><td>Ctrl+K Ctrl+ALT+K</td><td>Focus</td></tr></tbody></table><h1 id="cc">C/C++</h1><h1 id="vim">Vim</h1>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Boost</title>
    <link href="/Programming/C-C/C++%20Cookbook/Boost/"/>
    <url>/Programming/C-C/C++%20Cookbook/Boost/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h2 id="boostsplit">boost::split</h2><p>#include &lt;boost/algorithm/string.hpp&gt;</p><p><strong>Description:</strong> boost::split()函数用于切割string字符串，将切割之后的字符串放到一个std::vector<std::string> 之中。</p><p>有4个参数：</p><p>boost::split(type, select_list, boost::is_any_of(","), boost::token_compress_on);</p><p>(1)、type类型是std::vector<std::string>，用于存放切割之后的字符串</p><p>(2)、select_list：传入的字符串，可以为空。</p><p>(3)、boost::is_any_of(",")：设定切割符为,(逗号)</p><p>(4)、 boost::token_compress_on：将连续多个分隔符当一个，默认没有打开，当用的时候一般是要打开的。</p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>C/C++</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>强化学习中的off-line, on-line, off policy, on policy傻傻分不清</title>
    <link href="/Artificial-Intelligence/RL/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84off-line,%20on-line,%20off%20policy,%20on%20policy%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85/"/>
    <url>/Artificial-Intelligence/RL/%E5%BC%BA%E5%8C%96%E5%AD%A6%E4%B9%A0%E4%B8%AD%E7%9A%84off-line,%20on-line,%20off%20policy,%20on%20policy%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://blog.csdn.net/qq_42743778/article/details/120063861">https://blog.csdn.net/qq_42743778/article/details/120063861</a></p><p><a href="https://zhuanlan.zhihu.com/p/346433931">https://zhuanlan.zhihu.com/p/346433931</a></p>]]></content>
    
    
    <categories>
      
      <category>Artificial Intelligence</category>
      
      <category>RL</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Leetcode</title>
    <link href="/Programming/Leetcode/Leetcode/"/>
    <url>/Programming/Leetcode/Leetcode/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="字符串">字符串</h1><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1657/">1657.确定两个字符串是否接近</a></p><h1 id="others">Others</h1><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1/">1.两数之和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：2.两数相加/">2.两数相加</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode3/">3.无重复字符的最长子串</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：4.寻找两个有序数组的中位数/">4.寻找两个有序数组的中位数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：5.最长回文子串/">5.最长回文子串</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：7.整数反转/">7.整数反转</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：8.字符串转换整数/">8.字符串转换整数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：9.回文数/">9.回文数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode10/">10.正则表达式匹配</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：11.盛最多水的容器/">11.盛最多水的容器</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode13/">13. 罗马数字转整数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：14.最长公共前缀/">14.最长公共前缀</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：15.三数之和/">15.三数之和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：16.最接近的三数之和/">16.最接近的三数之和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode17/">17. 电话号码的字母组合</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode19/">19. 删除链表的倒数第 N 个结点</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：20.有效的括号/">20.有效的括号</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：21.合并两个有序链表/">21.合并两个有序链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode22/">22. 括号生成</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：23.合并K个排序链表/">23.合并K个排序链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode24/">24. 两两交换链表中的节点</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode25/">25. K 个一组翻转链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：26.删除排序数组中重复的项/">26.删除排序数组中重复的项</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode27/">27. 移除元素</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：33.搜索旋转排序数组/">33.搜索旋转排序数组</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：43.字符串相乘/">43.字符串相乘</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode44/">44. 通配符匹配</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：46.全排列/">46.全排列</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：53.最大子序和/">53.最大子序和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：54.螺旋矩阵/">54.螺旋矩阵</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode55/">55. 跳跃游戏</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：59.螺旋矩阵二/">59.螺旋矩阵二</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：61.旋转链表/">61.旋转链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：62.不同路径/">62.不同路径</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：70.爬楼梯/">70.爬楼梯</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：78.子集/">78.子集</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode82/">82. 删除排序链表中的重复元素 II</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：88.合并两个有序数组/">88.合并两个有序数组</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：89.格雷编码/">89.格雷编码</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode94/">94. 二叉树的中序遍历</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode95/">95. 不同的二叉搜索树 II</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode99/">99. 恢复二叉搜索树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode100/">100.相同的树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode101/">101. 对称二叉树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：104.二叉树最大深度/">104.二叉树最大深度</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode105/">105. 从前序与中序遍历序列构造二叉树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode106/">106. 从中序与后序遍历序列构造二叉树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode108/">108. 将有序数组转换为二叉搜索树</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：121.买卖股票的最佳时机/">121.买卖股票的最佳时机</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：122.买卖股票的最佳时机II/">122.买卖股票的最佳时机II</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：124.二叉树最大路径和/">124.二叉树最大路径和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode134/">134. 加油站</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：136.只出现一次的数字/">136.只出现一次的数字</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：141.环形链表/">141.环形链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：142.环形链表II/">142.环形链表II</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：146.LRU缓存机制/">146.LRU缓存机制</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：148.排序链表/">148.排序链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：155.最小栈/">155.最小栈</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：160.相交链表/">160.相交链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：169.众数/">169.众数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode203/">203. 移除链表元素</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：206.反转链表/">206.反转链表</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode208/">208. 实现 Trie (前缀树)</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：215.数组中的第K个最大元素/">215.数组中的第K个最大元素</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：217.存在重复元素/">217.存在重复元素</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：230.二叉搜索树中第K小的元素/">230.二叉搜索树中第K小的元素</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：231.2的幂/">231.2的幂</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：235.二叉搜索树的最近公共祖先/">235.二叉搜索树的最近公共祖先</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：236.二叉树的最近公共祖先/">236.二叉树的最近公共祖先</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：237.%20删除链表中的节点/">237. 删除链表中的节点</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：238.%20除自身以外数组的乘积/">238. 除自身以外数组的乘积</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：292.%20Nim%20游戏/">292. Nim 游戏</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode322/">322. 零钱兑换</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：344.%20反转字符串/">344. 反转字符串</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode392/">392. 判断子序列</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode415/">415. 字符串相加</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode435/">435. 无重叠区间</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode455/">455. 分发饼干</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode516/">516. 最长回文子序列</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode实战：557.%20反转字符串中的单词%20III/">557. 反转字符串中的单词 III</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode907/">907. 子数组的最小值之和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1012/">1012. 至少有 1 位重复的数字</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1143/">1143. 最长公共子序列</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1260/">1260. 二维网格迁移</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1487/">1487. 保证文件名唯一</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1605/">1605. 给定行和列的和求可行矩阵</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1615/">1615. 最大网络秩</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1626/">1626. 无矛盾的最佳球队</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1653/">1653. 使字符串平衡的最少删除次数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1721/">1721. 交换链表中的节点</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1775/">1775. 通过最少操作次数使数组的和相等</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1780/">1780. 判断一个数字是否可以表示成三的幂的和</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode1812/">1812. 判断国际象棋棋盘中一个格子的颜色</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2363/">2363. 合并相似的物品</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2373/">2373. 矩阵中的局部最大值</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2379/">2379. 得到 K 个黑块的最少涂色次数</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2383/">2383. 赢得比赛需要的最少训练时长</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2389/">2389. 和有限的最长子序列</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2469/">2469. 温度转换</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/Leetcode2488/">2488. 统计中位数为 K 的子数组</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/offer16/">剑指 Offer 16. 数值的整数次方</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/offer47/">剑指 Offer 47. 礼物的最大价值</a></p><p><a href="https://chenxindaaa.com/Programming/Leetcode/Leetcode/面试题05.02/">面试题 05.02. 二进制数转字符串</a></p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Leetcode</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Docker</title>
    <link href="/Programming/Docker/Docker/"/>
    <url>/Programming/Docker/Docker/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="docker教程">Docker教程</h1><h2 id="一docker三要素">一、Docker三要素：</h2><ol type="1"><li>image <span class="math inline">\(\rightarrow\)</span> class</li><li>container <span class="math inline">\(\rightarrow\)</span> instance</li><li>repository <span class="math inline">\(\rightarrow\)</span> 存放image的场所，官方registry称为Docker Hub</li></ol><h2 id="二安装">二、安装</h2><p><a href="https://docs.docker.com/engine/">步骤</a></p><p><code>Note：Set up the repository</code></p><p><a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">阿里云镜像加速</a></p><h2 id="三docker常用命令">三、Docker常用命令</h2><h3 id="帮助启动类命令">3.1 帮助启动类命令</h3><figure class="highlight nsis"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nsis"><span class="hljs-params">system</span>ctl start docker  <span class="hljs-comment"># 启动docker</span><br><span class="hljs-params">system</span>ctl stop docker  <span class="hljs-comment"># 停止docker</span><br><span class="hljs-params">system</span>ctl restart docker  <span class="hljs-comment"># 重启docker</span><br><span class="hljs-params">system</span>ctl status docker  <span class="hljs-comment"># 查看docker状态</span><br><span class="hljs-params">system</span>ctl enable docker  <span class="hljs-comment"># 开机启动</span><br>docker info  <span class="hljs-comment"># 查看docker概要信息</span><br>docker --help  <span class="hljs-comment"># 查看docker总体帮助文档</span><br>docker 具体命令 --help  <span class="hljs-comment"># 查看docker命令帮助文档</span><br></code></pre></td></tr></table></figure><h3 id="镜像命令">3.2 镜像命令</h3><ul><li>docker images [OPTIONS]：列出本地主机上的镜像<ul><li>各个选项说明: REPOSITORY：表示镜像的仓库源 TAG：镜像的标签版本号 IMAGE ID：镜像ID CREATED：镜像创建时间 SIZE：镜像大小 同一仓库源可以有多个 TAG版本，代表这个仓库源的不同个版本，我们使用 REPOSITORY:TAG 来定义不同的镜像。如果你不指定一个镜像的版本标签，例如你只使用 ubuntu，docker 将默认使用 ubuntu:latest 镜像</li><li>OPTIONS说明：<ul><li>-a :列出本地所有的镜像（含历史映像层）</li><li>-q :只显示镜像ID。</li></ul></li></ul></li><li>docker search [OPTIONS] 镜像名字：搜索镜像<ul><li>OPTIONS说明：<ul><li>--limit : 只列出N个镜像，默认25个 e.g. docker search --limit 5 redis</li></ul></li></ul></li><li>docker pull 某个XXX镜像名字：下载镜像<ul><li>docker pull 镜像名字:[TAG] 没有TAG就是最新版等价于docker pull 镜像名字:latest</li></ul></li><li>docker system df：查看镜像/容器/数据卷所占的空间</li><li>docker rmi 某个XXX镜像名字ID：删除镜像<ul><li>删除单个 docker rmi -f 镜像ID</li><li>删除多个 docker rmi -f 镜像名1:TAG 镜像名2:TAG</li><li>删除全部 docker rmi -f $(docker images -qa) ### 3.3 容器命令</li></ul></li><li>docker run [OPTIONS] IMAGE [COMMAND] [ARG...]：新建+启动容器<ul><li>OPTIONS说明：有些是一个减号，有些是两个减号<ul><li>--name="容器新名字" 为容器指定一个名称；</li><li>-d: 后台运行容器并返回容器ID，也即启动守护式容器(后台运行)；</li><li>启动交互式容器(前台有伪终端，等待交互)<ul><li>-i：以交互模式运行容器，通常与 -t 同时使用；(interactive)</li><li>-t：为容器重新分配一个伪输入终端，通常与 -i 同时使用；(terminal)</li><li>e.g. docker run -it ubuntu /bin/bash： 使用镜像centos:latest以交互模式启动一个容器,在容器内执行/bin/bash命令 /bin/bash：放在镜像名后的是命令，这里我们希望有个交互式 Shell，因此用的是 /bin/bash。要退出终端，直接输入 exit:</li></ul></li><li>-P: 随机端口映射，大写P</li><li>-p: 指定端口映射，小写p</li></ul></li></ul></li><li>docker ps [OPTIONS]：·列出当前所有正在运行的容器<ul><li>OPTIONS说明<ul><li>-a：列出当前所有正在运行的容器+历史上运行过的</li><li>-l：显示最近创建的容器。</li><li>-n：显示最近n个创建的容器。</li><li>-q：静默模式，只显示容器编号。</li></ul></li></ul></li><li>退出容器 关系 指向 进入正在运行的容器并以命令行交互 ·两种退出方式 ·exit ·run进去容器，exit退出，容器停止 ·ctrl+p+q ·run进去容器，ctrl+p+q退出，容器不停止 ·启动已停止运行的容器 ·docker start 容器ID或者容器名</li><li>重启容器 ·docker restart 容器ID或者容器名 ·停止容器 ·docker stop 容器ID或者容器名 ·强制停止容器 ·docker kill 容器ID或容器名 ·删除已停止的容器 ·docker rm 容器ID ·一次性删除多个容器实例 ·docker rm -f $(docker ps -a -q) ·docker ps -a -q | xargs docker rm</li></ul><h2 id="reference">Reference:</h2><blockquote><p><a href="https://www.bilibili.com/video/BV1gr4y1U7CY?p=1&amp;vd_source=bd05c11d5f9bf6d6b4849b57473d2194">尚硅谷Docker实战教程</a> <a href="https://space.bilibili.com/393424102">JJacobb</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Docker</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CMake</title>
    <link href="/Programming/C-C/CMake/CMake/"/>
    <url>/Programming/C-C/CMake/CMake/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><h1 id="最小配置示例">最小配置示例</h1><h2 id="cmakelists.txt">CMakelists.txt</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">cmake<span class="hljs-constructor">_minimum_required(VERSION 3.0)</span>  # cmake最低版本<br>project(sample CXX)  # 项目名称<br>add<span class="hljs-constructor">_library(<span class="hljs-params">sample</span> <span class="hljs-params">sample</span>.<span class="hljs-params">cpp</span>)</span>  # 添加库<br>add<span class="hljs-constructor">_executable(<span class="hljs-params">sample_exe</span> <span class="hljs-params">sample_exe</span>.<span class="hljs-params">cpp</span>)</span>  # 添加可执行程序<br></code></pre></td></tr></table></figure><h2 id="相关函数">相关函数</h2><ul><li>project：定义工程名称，并可指定工程支持的语言<ul><li>project(projectname [CXX] [C] [Java][C CXX])</li><li>项目对应的变量：<ul><li>PROJECT_NAME：项目名称</li><li>PROJECT_SOURCE_DIR：项目源码根目录</li><li>PROJECT_VERSION：项目版本</li><li>PROJECT_BINARY_DIR：项目生成的临时二进制目录，用于存放配置/编译中间文件。</li></ul></li></ul></li><li>add_library：生成库文件<ul><li>add_library(libname [SHARED|STATIC|MODULE][EXCLUDE_FROM_ALL] source)<ul><li>libname： 库名称</li><li>source：源文件，可以使用列表变量，也可以直接添加源文件名称，还可以使用函数 target_source 添加源文件</li><li>SHARED：声明该库仅被作为动态库生成</li><li>STATIC 声明该库仅被作为静态库生成</li></ul></li></ul></li><li>add_executable：生成可执行文件<ul><li>add_executable(exename source)</li></ul></li></ul><h2 id="生成项目">生成项目</h2><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs erlang">cmake -G <span class="hljs-string">&quot;Unix Makefiles&quot;</span> ..<br>make<br></code></pre></td></tr></table></figure><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">cmake.exe -S .<span class="hljs-regexp">/sample -B ./</span>sample/binary -G <span class="hljs-string">&quot;Visual Studio 16 2019&quot;</span> -A x64<br>cmake.exe --build .<span class="hljs-regexp">/sample/</span>binary<br></code></pre></td></tr></table></figure><h3 id="命令行参数">命令行参数</h3><ul><li>-S 顶级CMakeLists.txt（包含project声明）所在路径。</li><li>-B 存放临时编译的二进制文件（.obj、.ilk等）和编译器对应的配置文件路径。</li><li>-G 编译器名称</li><li>-A 架构名称</li><li>-D 使用该变量以向cmake传入各种参数，包括选项及覆盖cmake提供的各种默认变量值。</li><li>--toolchain cmake toolchain文件路径。</li><li>--install-prefix 安装的二进制存放路径。</li><li>--trace / --trace-expand 调试时使用，用于打印已执行的cmake代码及行号。否则仅输出函数message中的内容。</li><li>--build 使用cmake直接调用编译器编译项目。</li><li>--config 选择需要编译的项目配置类型。</li><li>--install 安装已编译好的二进制文件至 CMAKE_INSTALL_PREFIX 中。</li></ul><h1 id="依赖管理">依赖管理</h1><h2 id="查找依赖">查找依赖</h2><ul><li><p><a href="https://link.zhihu.com/?target=https://cmake.org/cmake/help/latest/command/find_package.html#id7">find_package</a>：使用预先设置的配置文件来查找依赖项 <figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs inform7">find_package(PACKAGE_NAME_CASE_SENSITIVE<br>             <span class="hljs-comment">[version]</span> <span class="hljs-comment">[EXACT]</span> <span class="hljs-comment">[QUIET]</span><br>             <span class="hljs-comment">[REQUIRED]</span> <span class="hljs-comment">[<span class="hljs-comment">[COMPONENTS]</span> <span class="hljs-comment">[components...]</span>]</span><br>             <span class="hljs-comment">[OPTIONAL_COMPONENTS components...]</span><br>             <span class="hljs-comment">[CONFIG|NO_MODULE]</span><br>             <span class="hljs-comment">[NO_POLICY_SCOPE]</span><br>             <span class="hljs-comment">[NAMES name1 <span class="hljs-comment">[name2 ...]</span>]</span><br>             <span class="hljs-comment">[CONFIGS config1 <span class="hljs-comment">[config2 ...]</span>]</span><br>             <span class="hljs-comment">[HINTS path1 <span class="hljs-comment">[path2 ... ]</span>]</span><br>             <span class="hljs-comment">[PATHS path1 <span class="hljs-comment">[path2 ... ]</span>]</span><br>             <span class="hljs-comment">[PATH_SUFFIXES suffix1 <span class="hljs-comment">[suffix2 ...]</span>]</span><br>             <span class="hljs-comment">[NO_DEFAULT_PATH]</span><br>             <span class="hljs-comment">[NO_PACKAGE_ROOT_PATH]</span><br>             <span class="hljs-comment">[NO_CMAKE_PATH]</span><br>             <span class="hljs-comment">[NO_CMAKE_ENVIRONMENT_PATH]</span><br>             <span class="hljs-comment">[NO_SYSTEM_ENVIRONMENT_PATH]</span><br>             <span class="hljs-comment">[NO_CMAKE_PACKAGE_REGISTRY]</span><br>             <span class="hljs-comment">[NO_CMAKE_BUILDS_PATH]</span> # Deprecated; does nothing.<br>             <span class="hljs-comment">[NO_CMAKE_SYSTEM_PATH]</span><br>             <span class="hljs-comment">[NO_CMAKE_SYSTEM_PACKAGE_REGISTRY]</span><br>             <span class="hljs-comment">[CMAKE_FIND_ROOT_PATH_BOTH |</span><br><span class="hljs-comment">              ONLY_CMAKE_FIND_ROOT_PATH |</span><br><span class="hljs-comment">              NO_CMAKE_FIND_ROOT_PATH)</span><br></code></pre></td></tr></table></figure></p><p>常用参数：</p><ul><li>PACKAGE_NAME_CASE_SENSITIVE 查找的库的名称，大小写敏感，与之对应的是调用了包含此名称的配置文件。</li><li>version 依赖的版本号。如果依赖的配置同时提供了版本文件，则会使用该值对比配置中的版本而确定是否可以使用。</li><li>EXACT 版本号必须严格对应配置中的版本号。</li><li>QUIET 关闭了查找信息（不包含查找失败/错误信息）的输出。</li><li>REQUIRED 如果库没找到就报错。</li><li>CONFIG 该关键字声明了需要使用 依赖项通过自己的cmake代码 使用cmake 自动生成的 配置文件，入口配置文件名称一般为 <LOW_CASE_PACKAGE_NAME>-config.cmake 或 <ALL_CASE_PACKAGE_NAME>Config.cmake 。</li></ul></li><li><p>find_library：原始的cmake查找依赖方式，直接查找依赖项库文件。 <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs prolog">find_library (<br>          &lt;<span class="hljs-symbol">LIBRARY_NAME</span>&gt;<br>          name | <span class="hljs-symbol">NAMES</span> name1 [name2 ...] [<span class="hljs-symbol">NAMES_PER_DIR</span>]<br>          [<span class="hljs-symbol">HINTS</span> [path | <span class="hljs-symbol">ENV</span> var]... ]<br>          [<span class="hljs-symbol">PATHS</span> [path | <span class="hljs-symbol">ENV</span> var]... ]<br>          [<span class="hljs-symbol">PATH_SUFFIXES</span> suffix1 [suffix2 ...]]<br>          [<span class="hljs-symbol">DOC</span> <span class="hljs-string">&quot;cache documentation string&quot;</span>]<br>          [<span class="hljs-symbol">NO_CACHE</span>]<br>          [<span class="hljs-symbol">REQUIRED</span>]<br>          [<span class="hljs-symbol">NO_DEFAULT_PATH</span>]<br>          [<span class="hljs-symbol">NO_PACKAGE_ROOT_PATH</span>]<br>          [<span class="hljs-symbol">NO_CMAKE_PATH</span>]<br>          [<span class="hljs-symbol">NO_CMAKE_ENVIRONMENT_PATH</span>]<br>          [<span class="hljs-symbol">NO_SYSTEM_ENVIRONMENT_PATH</span>]<br>          [<span class="hljs-symbol">NO_CMAKE_SYSTEM_PATH</span>]<br>          [<span class="hljs-symbol">CMAKE_FIND_ROOT_PATH_BOTH</span> |<br>           <span class="hljs-symbol">ONLY_CMAKE_FIND_ROOT_PATH</span> |<br>           <span class="hljs-symbol">NO_CMAKE_FIND_ROOT_PATH</span>]<br>         )<br></code></pre></td></tr></table></figure></p><ul><li>LIBRARY_NAME：由于直接查找库文件而不是查找配置文件，此名称仅作为结果中宏的前缀使用。</li><li>NAMES：此项声明了库文件的名称。值得注意的是，在UNIX-style系统中，自动添加“lib”作为库名称的前缀。</li><li>NAMES_PER_DIR：一个名称遍历查找一次，再用另一个名称遍历查找一次。而不是根据路径使用多个名称遍历。</li><li>查找完成后：<ul><li>如果查找到，则会设置 LIBRARY_NAME 为查找到的库文件的名称（包含全路径）。</li><li>如果没有查找到，则会将 LIBRARY_NAME 设置为 <LIBRARY_NAME>-NOTFOUND 。</li></ul><p>所以这里和 find_package 又有不同，我们应当使用以下代码判断是否查找到:</p><p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs isbl"><span class="hljs-variable"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable">PACKAGE_NAME</span> <span class="hljs-variable">MATCHES</span> <span class="hljs-string">&quot;-NOTFOUND&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-title">message</span>(<span class="hljs-variable">FATAL_ERROR</span> <span class="hljs-string">&quot;$&#123;PACKAGE_NAME&#125; not found!&quot;</span>)</span><br><span class="hljs-function"><span class="hljs-title">endif</span>()</span><br></code></pre></td></tr></table></figure></p></li></ul></li><li><p>find_path：这个函数一般是查找头文件或其他的 非库文件 且 非可执行程序。其函数原型为： <figure class="highlight prolog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs prolog">find_path (<br>         &lt;<span class="hljs-symbol">FILE_NAME</span>&gt;<br>         name | <span class="hljs-symbol">NAMES</span> name1 [name2 ...]<br>         [<span class="hljs-symbol">HINTS</span> [path | <span class="hljs-symbol">ENV</span> var]... ]<br>         [<span class="hljs-symbol">PATHS</span> [path | <span class="hljs-symbol">ENV</span> var]... ]<br>         [<span class="hljs-symbol">PATH_SUFFIXES</span> suffix1 [suffix2 ...]]<br>         [<span class="hljs-symbol">DOC</span> <span class="hljs-string">&quot;cache documentation string&quot;</span>]<br>         [<span class="hljs-symbol">NO_CACHE</span>]<br>         [<span class="hljs-symbol">REQUIRED</span>]<br>         [<span class="hljs-symbol">NO_DEFAULT_PATH</span>]<br>         [<span class="hljs-symbol">NO_PACKAGE_ROOT_PATH</span>]<br>         [<span class="hljs-symbol">NO_CMAKE_PATH</span>]<br>         [<span class="hljs-symbol">NO_CMAKE_ENVIRONMENT_PATH</span>]<br>         [<span class="hljs-symbol">NO_SYSTEM_ENVIRONMENT_PATH</span>]<br>         [<span class="hljs-symbol">NO_CMAKE_SYSTEM_PATH</span>]<br>         [<span class="hljs-symbol">CMAKE_FIND_ROOT_PATH_BOTH</span> |<br>          <span class="hljs-symbol">ONLY_CMAKE_FIND_ROOT_PATH</span> |<br>          <span class="hljs-symbol">NO_CMAKE_FIND_ROOT_PATH</span>]<br>        )<br></code></pre></td></tr></table></figure> 一般情况下，由于需要cmake表达式来让cmake判断使用哪个配置的库，我们通常这么写：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">find_path</span><span class="hljs-params">(&lt;PACKAGE_NAME&gt;_INCLUDE_DIR NAMES header.h PATH_SUFFIXES include/...)</span></span><br><br><span class="hljs-function"><span class="hljs-title">find_library</span><span class="hljs-params">(&lt;PACKAGE_NAME&gt;_LIBRARY_RELEASE NAMES name1 name2)</span></span><br><span class="hljs-function"><span class="hljs-title">find_library</span><span class="hljs-params">(&lt;PACKAGE_NAME&gt;_LIBRARY_DEBUG NAMES name1d name2d)</span></span><br><span class="hljs-function"><span class="hljs-title">select_library_configurations</span><span class="hljs-params">(&lt;PACKAGE_NAME&gt;)</span></span><br>...<br>target_*(target_name $&#123;&lt;PACKAGE_NAME&gt;&#125;)<br></code></pre></td></tr></table></figure></li><li><p>find_program：这个函数专门用于查找可执行程序</p></li></ul><h2 id="使用依赖">使用依赖</h2><p>经过了上面的狂轰乱炸，我们终于可以使用依赖项了。我们可以将查找到的依赖项用于多个函数中，例如添加头文件路径，添加链接库，添加编译选项等。</p><p>对于不同的查找方式，配置文件或cmake提供了不同的使用方式：</p><ul><li><p>宏 例如 <PACKAGE_NAME>_INCLUDE_DIRS 和 <PACKAGE_NAME>_LIBRARIES 这种方式。</p><p>对于头文件来讲，直接加到include_directories中就好了。而对于库来讲，则复杂点：</p><p>由于不能混合使用debug库及release库，cmake必须明确知道在不同配置下使用哪个库。所以宏中一般使用到了cmake表达式来处理这种情况，比如： <span class="math inline">\(&lt;\)</span><CONFIG:DEBUG>:library.lib&gt; <span class="math inline">\(&lt;\)</span>{NOT:$<CONFIG:DEBUG>&gt;:libraryd.lib&gt; 所以我们在写配置时，尽量将debug和release库均查找后使用 select_library_configurations 来生成表达式以便不同配置下使用。</p></li><li><p>target target 就简单的多了，因为它是一个object，cmake函数可以轻松提取 target 包含的需要使用的属性来使用。 当然，target 包含非namespace与namespace两种形式，不过使用上没区别。 ## 内部依赖</p></li><li><p>add_dependencies： <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">add<span class="hljs-constructor">_dependencies(&lt;<span class="hljs-params">target</span>&gt; [&lt;<span class="hljs-params">target</span>-<span class="hljs-params">dependency</span>&gt;]<span class="hljs-operator">...</span>)</span><br></code></pre></td></tr></table></figure> 向前者添加依赖项（后者），可以添加多个。在编译或某些配置时，优先处理后者。</p></li></ul><h1 id="编译相关函数">编译相关函数</h1><h2 id="关键字">关键字</h2><ul><li><p>target target在cmake中是一个很重要的概念，可以理解为一个实例化对象， 一般是由add_executable()，add_library() 或 add_custom_target() 命令之一创建，它包含了例如以下内容：</p><ul><li>相关的源文件列表</li><li>相关的编译选项</li><li>相关的依赖库</li><li>相关的头文件路径列表</li><li>相关的库文件路径列表</li><li>相关的其他属性</li></ul></li><li>PUBLC PRIVATE INTERFACE 例如 target_link_libraries(A [PUBLIC/PRIVATE/INTERFACE] B)<ul><li>PUBLIC 依赖项B仅链接到目标A，若有C链接了目标A，C不链接依赖项B。</li><li>PRIVATE 依赖项B并不链接到目标A，若有C链接了目标A，C会链接依赖项B。</li><li>INTERFACE 依赖项B链接到目标A，若有C链接了目标A，C也会链接依赖项B。 &gt; <a href="https://www.jianshu.com/p/07761ff7838e">CMake 中的 PUBLIC，PRIVATE，INTERFACE</a></li></ul></li></ul><h2 id="相关函数-1">相关函数</h2><ul><li><p>target_compile_options：向目标添加编译选项 <figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">target_compile_options(&lt;<span class="hljs-keyword">target</span>&gt; [BEFORE]<br>  &lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items1...]<br>  [&lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items2...] ...])<br></code></pre></td></tr></table></figure> 例如： <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">target<span class="hljs-constructor">_compile_options(<span class="hljs-params">sample</span> PUBLIC <span class="hljs-operator">/</span><span class="hljs-params">arch</span>=<span class="hljs-params">avx2</span> <span class="hljs-operator">/</span>Wall)</span><br></code></pre></td></tr></table></figure></p></li><li><p>target_compile_definitions：向目标添加预设宏声明及定义</p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">target_compile_definitions(&lt;<span class="hljs-keyword">target</span>&gt;<br>  &lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items1...]<br>  [&lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items2...] ...])<br></code></pre></td></tr></table></figure> 例如： <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">target_compile_definitions</span><span class="hljs-params">(sample PRIVATE BUILD_DLL PUBLIC <span class="hljs-string">&quot;-DPI=3.14159&quot;</span>)</span></span><br></code></pre></td></tr></table></figure></li><li><p>target_include_directories：声明了编译目标时查找使用头文件的路径。</p><p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">target_include_directories(&lt;<span class="hljs-keyword">target</span>&gt; [SYSTEM] [AFTER|BEFORE]<br>  &lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items1...]<br>  [&lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items2...] ...])<br></code></pre></td></tr></table></figure></p>例如： <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">target<span class="hljs-constructor">_include_directories(<span class="hljs-params">sample</span> PUBLIC <span class="hljs-params">public</span><span class="hljs-operator">/</span><span class="hljs-params">include</span><span class="hljs-operator">/</span><span class="hljs-params">sample</span> PRIVATE <span class="hljs-params">sample</span>)</span><br></code></pre></td></tr></table></figure></li><li><p>target_link_libraries：声明了链接时需要参与的依赖库名称或target，其名称可包含完整路径。</p><p><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">target_link_libraries(&lt;<span class="hljs-keyword">target</span>&gt;<br>  &lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items1...]<br>  [&lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items2...] ...])<br></code></pre></td></tr></table></figure> 例如： <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">target<span class="hljs-constructor">_link_libraries(<span class="hljs-params">sample</span> PUBLIC CURL::<span class="hljs-params">curl</span> <span class="hljs-params">glib</span> <span class="hljs-params">m</span>)</span><br></code></pre></td></tr></table></figure> 注意：由于一个target中包含多个属性，一般情况下包含了头文件路径。所以使用target作为参数传入此函数时，无需调用 target_include_directories 再次声明添加头文件路径。</p></li><li><p>target_link_libraries：声明了链接时查找依赖库的路径。 <figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs fortran">target_link_libraries(&lt;<span class="hljs-keyword">target</span>&gt; [BEFORE]<br>  &lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items1...]<br>  [&lt;<span class="hljs-keyword">INTERFACE</span>|<span class="hljs-keyword">PUBLIC</span>|<span class="hljs-keyword">PRIVATE</span>&gt; [items2...] ...])<br></code></pre></td></tr></table></figure> 例如： <figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">target<span class="hljs-constructor">_link_libraries(<span class="hljs-params">sample</span> PUBLIC <span class="hljs-params">third_party</span><span class="hljs-operator">/</span><span class="hljs-params">libs</span><span class="hljs-operator">/</span><span class="hljs-params">x86</span><span class="hljs-operator">/</span><span class="hljs-params">rel</span>)</span><br></code></pre></td></tr></table></figure></p></li></ul><h2 id="target族函数注意事项">target族函数注意事项</h2><p>当需要使用cmake export关键字导出声明的target并附带其中的 PUBLIC 属性时，我们必须 将PUBLIC / PRIVATE / INTERFACE 关键字向这类 target 族函数补齐。且如果一个 target 族函数声明了这三个关键字其中之一，该 target 所属的其他 target 族函数均应当声明关键字。且对于包含路径的值，我们需要声明此值的使用范围：</p><p>编译/链接时使用。必须使用绝对路径。 导出以向下游提供。必须使用相对路径。 所以，我们通常情况下使用以下方式：</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs ruby">target_include_directories(sample <span class="hljs-variable constant_">PRIVATE</span> <span class="hljs-variable">$&lt;</span><span class="hljs-variable constant_">BUILD_INTERFACE</span><span class="hljs-symbol">:</span><span class="hljs-variable">$&#123;</span><span class="hljs-variable constant_">CMAKE_SOURCE_DIR</span>&#125;/header/<span class="hljs-keyword">include</span>&gt; <span class="hljs-variable constant_">PUBLIC</span> <span class="hljs-variable">$&lt;</span><span class="hljs-variable constant_">INSTALL_INTERFACE</span><span class="hljs-symbol">:include&gt;</span>)<br></code></pre></td></tr></table></figure><h1 id="reference">Reference</h1><p><a href="https://www.zhihu.com/column/c_1490802622991306752">CMake教程系列</a></p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>C/C++</category>
      
      <category>CMake</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Effective Academic Writing</title>
    <link href="/Research/Academic-Writing/Effective%20Academic%20Writing/"/>
    <url>/Research/Academic-Writing/Effective%20Academic%20Writing/</url>
    
    <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="1e298c201dc0bfe76af7e192bc1de09f691f714bfdedfe8ecd7bf2ae38a305d6">4630436162ade97ba2718b7d0c4b3b630feb3b48bea4a303f664086afc210114fc615933b47ea0ac7d43594df641b32db65df296f48d3818e31a91a9c53fcca057750c57d14899e794824cc8fb93819f404849cee20ba10291e94c38b919d3dbaab337791e1e529c029a610f27331a77e30f30514fe20d384c11dd81650530bf1fc847d3d1d0fce3ed52b38961ea733bdc26a10f8aad0b35911c90b087962e3a000a2ba52029344ae7ad6879443984a07b7c78a2361e9b9bf8595927e5ad89ab46f9cb606cdc914d315ed9b999e51c4a9702a8f6ff7e6667836d62ed3b31ac802946a279cfa791927cb6dc4975f3b9fa67806664cf8c6f07e37ac1d9c958d6b316fae838cec3696db706edd53927998eeb48e3201e41f8197bb95e389955f8fdfc37cf6762c3b1575fbf92ce4782c858ef878663a8f3d0ef513bee4d4adde2a32c97df46b3d4c53218901f2cdda252515e4820c7f060a8743f8efc6b539951e5885a0ecb06aa8789555596895a55bf63aea461be7f05a63a9b53247a8c6ccbdaeb2bdb2b6bb08cf7b35e401e482841fce1bbd0c6a66110db971b7253f2e1aa4793ec3072431e4e4022b1192ea8b74f6a6ee74edeeb5411a59ab7461f7bf8e0a4ffc093533b6d8602fb088968a599681ccb3246724e8e00f7b5206d85b31972c22abc6b2cd8e99db587ddf7a3b385453bbf04d4b5a6826a9039373eae67744aa90913445517aed45d6812e03b5b7c6a76a1ca17f59b43ab0556c8c80ed9b1a7b09d93aa069531c18d1e5bbee4213b27541db7247500dc8cfb0a0b3695b26a3bb0945c51dde906e383c620a48d1666a4ca4f9aafeabb07f39be99b2bc4fb543479c46420d08c2a8c603d565798c01e6bae3ac7ab0511ae5077c14ac1d7dba1ac6471651f6fde2009e4aeb70b088d98471babf370e07e66b3d83fa5df7f139f4416c62763179ce5b56a772d1c1b2d85830f37588ecde6aad3fd06a80e94b016d9f1d850ed6a900cda8039c9d6fa1ff20b46e55603df59c711b9fabd3c60f089da7702d244e43fa70350753f6f1d41f0acd7636d2cdbec98fdb0141d93f7073f8dd1650e0e6074f37fdb94098c3d3bda6392dbd4136fd5e4e842652d46165a3d95c4a45b872738398b42c532fa6764d1d567c617524cc1b81678f765394fd56d6f28a503fe40b2af0bdcb0de45c41f3a57d0ae5b81fbc71f134f638d49f9f195f61d5852d933ecdd18bd4151f0ea87eb41371ed626b20a5c6e08074a6e8534f89394bb681d531e0671971e5f1ceb6d7908df71c4d2d609477622008fbb395b6f9df3671628eabb7c5d83bf65e2ec00abf62cab3630e4740c19ce9dc0bc10f5f91c0db848fc9b6cc8bd557f7246687e3e076811af86e9e0b3e0cfed05f07b477908a7465b463905c62edf0c8389549262087ce96447516d11ea65f016ab72ceeb4210648e9812ba82867fa12f2a9b54497f844293d50aa5627954fc064bdb362c4671dad0274538a1e6e1175418f02e881744c57510736c522f190a233623a7ef9cdeee13b3c81138fc2d0f290de728a4162d79804d3b3bd1b397157dbdf23c20f285cd2279bf6ff70369e34bb43a90428ada6b462911fc4577ba00e9481509f04fb264b3bd3dd64f3b72d797c0bd0b95c9d8b4fa6c31cb3cf7ca501470d5cacf081cf6d3314db0624055d2ea17c433918afd45d608fd36a2a5c56ed2a26cc5c7b82c9065750a105dbeac296d7bcd9c726664913c45ca38e2ce1988ee4418fd3722af959d080b54e335715288b26863316980f1cb8646dd1c28bdce3ef5dfece95102adf32a2f3a0ff124103989c097102cada7c8e733ff2bcdc0e79b348ed52adb7d293cbb621a683d46543a2b52e75bae0e8066429a21b3f133ad44348aec5796e272d33828c83884fd970299f76fa98a458967e19856ac01ab81ecaa891924f6e41aaa7b0da457d1cd2e5c267c9a893d33565963cf1436af07eb2f25db41fdf92b9807acba9b602e296caa9cd9b134e308f93505407f71a47504d15b2bf04e36c4ddf37f8d6af13590def34ebaf156e1b98d42520db39a01682ea09efb1d90e80840c73cf1a1361d90a8c650158ff227a924432ebbc930483887df3d87dca8a848bb1e85ded297f04dd8936da46efd9066d4efb66eb61158a06f70d66e329f3cbeb1325298722ab46138519808e434251726ba8ae02c6bb17147151100742a2c574ae86566aef927476832230be466e85b833033ed772f6a666bd6a243372355c12a25d7582ca36050f988ac1b1b22267c97820709e350531eab45a26ef44c023941895357077e7c21edd67586a6d2e91178962bf9f9590c509fc510fda6bf1956e3db301dcff92fc4a99eb13e92386ad5218eae3f087b086e5c38415ee2509ef87c6c3a999bc5fc3913ce8f6b719e09920b96c77366665129269d01fdbfe3ec43173f4e1bb1ee51851b9e97b257337ad515c0df86936334b619fd1ed5f8211637d3881ae6b1dc80481a82c95e99e9f0f057777d872278cecbd54f82771c2be3b95f3c0469dcc11b8acf89b75b2bb54a24d8cd1bd0bb230ffb655605a122639043e506aa591fc8d392a474f9dd87a7bf5e605e87ac01014ab3c2ca243d245d254d01437a80815c46096fad66b99d110c093ed164e0a046e5455ec3ba4ff8c886421fc60193d4bbd989ee344cf6b7ff5fae24c0e15e850edcadaf0bef482cd3178cce04a769d03717881b04439387f003082aa0feffeb8a05a3809c2830c57243c241d777abf664be28500d3f0a2ab8ed27b2eddbe9e4b098b403fdfbcdb2b2a63e2a61505f5462cefe6818ef26554483372f56ec0002723c0a7fcefc3927a4187934866ca210ee0ae5cbe16e38c21f4e1384581875b06321abd1a9ebd8b65fde5f44c3b6cb6365a38b7b188f759020bf23600f8ab4665d06dffcd8b0be0f4d28f11ceb8aa700082434ecabcee8aae1bf7a7782088864e42eb85bc61d2c7f2850ae12d7fbb6a85d8c854196934a075603f51f6d48c53afb4ca3c3dd23e5bed7e7ec6beca8ec7db625834ac31ebb6e1c82a6e94a47f5b9a8689d0b0da7815759419b9fc58dfd68b23a0c772b140a71882859fd4dc15e8523ddf09d76fe27c8b9c689b2e65564300556274db82f291f7db7523b2840210d0f49d49c93faf857cd946ee4344a8623334d4fe24a05c795624ff10a0cc54e1b9e80f6153f4660b553fbd6b67705c3e96653860cd1eac31dcba95fe1f0755b5a2feea9a140cb036bfb90e5628cfbf7d3ea01e78bceac866ed3111b42a57b3894bfea448c596f3ac71c82a1bb5612e311546ea96344688f7628f1ece97181fb182c807dcf5ff05ab5c4ee7513f1fbe91b5247847b73193c8d28a93a0b200198818d83e3a94fa8ae2f9be89e58f8e2e2617ef242f8fa74cb3ca6de8e0db805dc64cf7a0f3f2a68acfc7b2e80f656cb714ecbfb9b471a21f97d8f9df160e49f0ba56142158b324ab1e639174bd544c47a851274e37e906b8c0e0ddc67dcb2a5d7aaaf6c694186d117f03c759aa301a7da4f493fdf8a0b53d695273e3199476193c4b3e2fbecf2810cda24d5b9ad04e989d43c647345f24c9f9c62615b26cabacf1cca9303bfa6532ebcfc9d490e119cf6b5233816250c4e6e90548b19205e61d78cabc5adfb37cea830d5501453815d22105f2a613558ae9ed0eb71c3c9a55895ec7d961b4c856a92f17ab286a7d2da34484391943ee4c867455f08fac5cac00e1560f574d48db42cd8a5867ffabbfba78eac886604c90df0df895572c7bcc9981212592c5a645423a0a688a09fe4a22d2fb4774e8c0cff9b0cb01b477ad961c2277f36710c37208ed52f4eb496d0d55e4bb0b4917412b50f3f81ce809ae6c33f2c243beb6a63806cd675378ca0b288c530055fbcfd7e9b90e252002b1137de75a49d53c052bc42fa3627b059a61c9d2fefff95c5717b599598d2d8087317ac0ef6421ee6fba689fcf164ded6e0b5f55e451405b27672958a7017a807dcb2e888d8be236193bb5781cca6dcd0bf632465f2892842f22de44e6f938acd4d43b351f7055560ce09959651e6973d05a41258534343b36640ad23e8c54115951a96308e276184b7203e685b612f7e6875459b51b12c28036b123c043121ede5106ea28cb4b1bc7abaf536d54a914a0850bff1f81724752d8343e2bda16d37b3528f1e50b89b50e58d7233178b297ca3463bfbad9f1e2fd05b334f8a3609e83d921c8a6ff22a7aaa868930b5a96d4bb058d3d2279c187a39d1ea7a663c6db025aa9ce2ca4d559a8112a3689ee908b69d1d4cdbc1f060f45d075588ee2a7fd6d97768940b01eb6513bfc686a0c782c3388f75166135bb848725843a4fa3bc725b458d9c81484ac8a9e8135e0c39b31c97d835709fb4912cbb62608dc88a4982af88286a947a215fd8d5c341bb67adcfd215209356a54c843c314ad8a4178192258e78c41a12a0629248c375c1817155a07de1e12aa2bfd8f86c3b2ea7f0df5edc44f191978442cf359df22d441f46a936ac8dedcdc4b2e85f422f824bea1fe2eea19bf4d7468d7623254e6ad3ba5ee29298c14d945ab8460d25bd7943adcf48358557bbb22c2cba7db519b59b20320663a7809f7efcefd2378e3d73bf1d8acd63fd9ee95c881b9bd818f6827f8069f50154cce163a6cbe04c7ea4d933c9d2a967fef6a192df74429895fb3df7692456f1d7dba089ec84c2980be5591038f0e3763befb620beeded990b5aabced09094d2a047ccae7bc456157c4387b91a352b809cf02a08b64765024bc230f7c75395a2dad6991eaa3314fa6ef30a0adeeaf2a26dc8443317cb5f8387780f6a9fe30bf1c207b421d708eb7c2003525c6a0f4ff773978ae804f0964b90a7c7d2118a60d323d3ba0658678f05edf77fd8b167c9547fa26cac0d2e55b14b9ba0f61e2e1a5abd702a8c95553de5986b4a13927b3830d05843a3a6c96d554ce6bf6799184d9bbc6b5f41641102eeef8324dcac7ec9e43a227081524084f290f7ac160fbe604eea368a4af50418292dce242a9f6cb50c8a751ce622bac7486459f69ddd7c3f75ba8bb6fe9bbd529eb5d1075448150df59df9a34e8496d8a54349c50f40ee8b70f2af0c6edf3b35f2e02dc86003af56cf1d05347811c85af894191675a3c3bd3b481017873c17266e13307fad82f8ae19defc29a7c137c87367ac1b6cef641765cae7302041e41d2f3418d9df3cd53fb3dee2f74a40652a0420352ac8694b77a4e314e987507a330fefd42547c92ef15282b87a04c5786ef5992301c1564ab1265c88b5309a6760db091ac9db85ccd98d7cef3cde148913e189e4b8bfe822e19e1b811a257d6572e16caae83d10fe03af3e3731dd64f0db4f22db64e759cb4914138ffb5f9ecedcb76b090cbb27359ce3a333ec37a50ba0bfe44b2351784249a08299b95a9d9052d6bcdd01deebdb66f04278014612586c2b95b5e3de394ed7a5bf92a29c2adc5d20bbb49e6c43ea17166919d758778b4775d5fbd2f0664ecfc5e91424f53042b6a52020e57c9908113151c62ee75e8a24801208f5e1de7ba2775949b28439d0b0554ca1c85985e3c73ec4cdd262167080eb4c126ff6d90dacf3d403005648e7535e6015b1050ba12b870f02a799ed87906ad5d7513d589cf91d78dc0e82651dbe339c30aba154e7d8f551568213096aed457903d368c03eea1bc5a8f12bec914e23f7835947aa5565ae26849d456079b05c9d2a333dcd395350451fe1101ab371b1d17d11ef156e8e8518990757277c9b016e527672c1c149c82b673853aa0f2c9ae9af3dd14066b0d518bf7d85006b9e2889aa1b22991b8890cafe8c8d2e09f2a72cb295c121e287</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Welcome to my blog, enter password to read.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    
    <categories>
      
      <category>Research</category>
      
      <category>Academic Writing</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>AI Infra</title>
    <link href="/Infra/CUDA/AI%20Infra/"/>
    <url>/Infra/CUDA/AI%20Infra/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Programming/Python/PyTorch/Dive%20into%20DL/Dive%20into%20DL-Linear%20Regression/">Linear Regression</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/CV/Dive%20into%20DL/Dive%20into%20DL-Softmax%20Classification/">Softmax Classification</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/CV/Dive%20into%20DL/Dive%20into%20DL-Multilayer%20Perceptron/">Multilayer Perceptron</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Text%20Prepare/">Text Prepare</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Language%20Model/">Language Model</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Recurrent%20Neural%20Network/">Recurrent Neural Network</a></p>]]></content>
    
    
    <categories>
      
      <category>Infra</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Dive into DL</title>
    <link href="/Artificial-Intelligence/DL/Dive%20into%20DL/"/>
    <url>/Artificial-Intelligence/DL/Dive%20into%20DL/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Programming/Python/PyTorch/Dive%20into%20DL/Dive%20into%20DL-Linear%20Regression/">Linear Regression</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/CV/Dive%20into%20DL/Dive%20into%20DL-Softmax%20Classification/">Softmax Classification</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/CV/Dive%20into%20DL/Dive%20into%20DL-Multilayer%20Perceptron/">Multilayer Perceptron</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Text%20Prepare/">Text Prepare</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Language%20Model/">Language Model</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/DL/NLP/Dive%20into%20DL/Dive%20into%20DL-Recurrent%20Neural%20Network/">Recurrent Neural Network</a></p>]]></content>
    
    
    <categories>
      
      <category>Artificial Intelligence</category>
      
      <category>DL</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GPU Hardware Resources</title>
    <link href="/Infra/CUDA/infra/GPU%E7%A1%AC%E4%BB%B6%E8%B5%84%E6%BA%90/"/>
    <url>/Infra/CUDA/infra/GPU%E7%A1%AC%E4%BB%B6%E8%B5%84%E6%BA%90/</url>
    
    <content type="html"><![CDATA[<h1 id="一gpu硬件资源">一、GPU硬件资源</h1><h2 id="流多处理器--sm">1. 流多处理器--SM</h2><p><img src="https://i-blog.csdnimg.cn/direct/30bd72204f464210bd6f199724a5f67a.png" alt="在这里插入图片描述" /> <img src="https://i-blog.csdnimg.cn/direct/738ddcbb3f164c909521d03b63ad3ea2.png" alt="在这里插入图片描述" /> <strong>串行和并发的区别：</strong></p><ol type="1"><li>硬件执行单元利用</li></ol><p>串行执行：</p><ul><li><p>流水线停顿（Pipeline Stall）：数据依赖导致流水线气泡</p></li><li><p>资源闲置：ALU、FPU等执行单元利用率低（通常&lt;30%）</p></li><li><p>冯·诺依曼瓶颈：单一指令流，顺序访问内存</p></li></ul><p>并发执行：</p><p>多发射（Multiple Issue）：单周期发射多条指令</p><p>执行单元并行：多个ALU/FPU同时工作</p><p>乱序执行（OoOE）：动态调度隐藏延迟</p><ol start="2" type="1"><li>内存层次结构影响</li></ol><p>串行内存访问：</p><p>CPU核心 → L1 Cache → L2 Cache → L3 Cache → 内存 → 磁盘 ↓ ↓ ↓ ↓ ↓ 命中延迟 命中延迟 命中延迟 100ns 10ms (1ns) (4ns) (10ns) │ │ └── 内存墙问题 ──┘</p><p>并行访问：</p><p>核心1 → L1 → L2 → L3 → 内存控制器 → DRAM Bank 1 核心2 → L1 → L2 → L3 → 内存控制器 → DRAM Bank 2 核心3 → L1 → L2 → L3 → 内存控制器 → DRAM Bank 3 核心4 → L1 → L2 → L3 → 内存控制器 → DRAM Bank 4 ↓ ↓ ↓ ↓ ↓ 并行访存 独立 共享但 交错访问 Bank并行 缓存 分区</p><p><strong>关键差异：</strong></p><ul><li><p>行缓冲冲突：串行访问同一DRAM Bank导致频繁预充电</p></li><li><p>总线竞争：单一线程无法饱和内存带宽</p></li><li><p>预取效率：并发可隐藏预取延迟</p></li></ul><ol start="3" type="1"><li>现代CPU架构的并发支持</li></ol><p>多级并行体系</p><p>指令级并行 (ILP) ├── 流水线 (Pipeline)：5-20级深 ├── 超标量 (Superscalar)：4-8路发射 ├── 乱序执行 (OoOE)：192条指令重排序窗口 └── 推测执行 (Speculation)：分支预测</p><p>线程级并行 (TLP) ├── 同步多线程 (SMT/Hyper-Threading)：2-8线程/核心 ├── 多核心 (Multi-Core)：4-128个物理核心 └── 众核心 (Many-Core)：数千个简化核心</p><p>数据级并行 (DLP) ├── SIMD (SSE/AVX)：256-512位向量 ├── GPU并行：数千个流处理器 └── 张量核心：专用矩阵运算</p><p>3.2 资源冲突对比</p><table><thead><tr class="header"><th>资源类型</th><th>串行执行问题</th><th>并发执行优势</th><th>瓶颈风险</th></tr></thead><tbody><tr class="odd"><td>执行端口</td><td>端口利用率低</td><td>多端口同时使用</td><td>端口竞争</td></tr><tr class="even"><td>重排序缓冲区</td><td>窗口空闲</td><td>多线程填充窗口</td><td>ROB容量</td></tr><tr class="odd"><td>缓存</td><td>局部性有限</td><td>多工作集预热缓存</td><td>缓存污染</td></tr><tr class="even"><td>内存带宽</td><td>无法饱和</td><td>聚合带宽利用</td><td>控制器竞争</td></tr><tr class="odd"><td>TLB</td><td>页表覆盖小</td><td>多线程共享TLB</td><td>TLB抖动</td></tr></tbody></table><h2 id="线程模型与物理结构">2. 线程模型与物理结构</h2><figure><img src="https://i-blog.csdnimg.cn/direct/ce38fe5f8ae449dd82a09e944be84945.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="线程数束">3. 线程数束</h2><figure><img src="https://i-blog.csdnimg.cn/direct/e7a51ade40bd4071928297862890d4f8.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p><img src="https://i-blog.csdnimg.cn/direct/4ad50a5fcdfb4709b8ae696d9b8d0880.png" alt="在这里插入图片描述" /> <strong>为了最大化GPU效率，线程块内的线程个数是32的整数倍</strong></p><h1 id="二cuda内存模型概述">二、CUDA内存模型概述</h1><h2 id="内存结构层次特点">1. 内存结构层次特点</h2><figure><img src="https://i-blog.csdnimg.cn/direct/d6031c7b80d94cb5b4d71ca75b3327eb.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="cuda内存模型">2. CUDA内存模型</h2><p><img src="https://i-blog.csdnimg.cn/direct/7983564642044841b6f43a7021601ef0.png" alt="在这里插入图片描述" /> <strong>共享内存是片上内存</strong></p><p><img src="https://i-blog.csdnimg.cn/direct/80531f3276654d14ada23d59042fb4a1.png" alt="在这里插入图片描述" /> # 三、寄存器和本地内存</p><h2 id="寄存器">1. 寄存器</h2><figure><img src="https://i-blog.csdnimg.cn/direct/8978e23664374323a51f35b9f95aec8e.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/8480d859afce49ffb95aa18ad2e94ab7.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="本地内存">2. 本地内存</h2><p><img src="https://i-blog.csdnimg.cn/direct/c3739a8563444c73b30f4728743fe92d.png" alt="在这里插入图片描述" /> <img src="https://i-blog.csdnimg.cn/direct/f867c5a30d60477bb1cea1fd9580b5dc.png" alt="在这里插入图片描述" /></p><h2 id="寄存器溢出">3. 寄存器溢出</h2><figure><img src="https://i-blog.csdnimg.cn/direct/a45f28fefd494960aabe9c38d828eb70.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">nvcc --resource-usage registerNum.cu -o registerNum -<span class="hljs-built_in">arch</span>=sm_86 &amp;&amp; ./registerNum<br></code></pre></td></tr></table></figure><p><img src="https://i-blog.csdnimg.cn/direct/bec8ff7c616541ae9a9a08c19fb653cc.png" alt="在这里插入图片描述" /> 全局内存使用为0，代表静态全局内存使用情况</p><h1 id="四全局内存">四、全局内存</h1><h2 id="全局内存">1. 全局内存</h2><figure><img src="https://i-blog.csdnimg.cn/direct/4074adce363b437fa32f39bc1e4f6263.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="全局内存初始化">2. 全局内存初始化</h2><p><img src="https://i-blog.csdnimg.cn/direct/4c0fc8f3a9dd468fb79a3cf0ae2a0dcf.png" alt="在这里插入图片描述" /> <strong>静态全局变量必须在主机和设备函数外定义</strong></p><h1 id="五共享内存">五、共享内存</h1><h2 id="共享内存作用">1. 共享内存作用</h2><p><img src="https://i-blog.csdnimg.cn/direct/9e26e54fed834c26a4b43aabb5255686.png" alt="在这里插入图片描述" /> <img src="https://i-blog.csdnimg.cn/direct/2ef0a4a3f4264af38f5489e8861e9ea7.png" alt="在这里插入图片描述" /> <img src="https://i-blog.csdnimg.cn/direct/69c727a855f14f069b0728e0c865c7ef.png" alt="在这里插入图片描述" /></p><h2 id="静态共享内存">2. 静态共享内存</h2><p><img src="https://i-blog.csdnimg.cn/direct/0b6a635cc7f7484eb5ae80c7b0813ee2.png" alt="在这里插入图片描述" /> cuda支持一维、二维和三维静态共享内存 ## 3. 动态共享内存 <img src="https://i-blog.csdnimg.cn/direct/3fc4385dc1344efd9289874659c88430.png" alt="在这里插入图片描述" /></p><h1 id="六常量内存">六、常量内存</h1><h2 id="常量内存的作用">1. 常量内存的作用</h2><figure><img src="https://i-blog.csdnimg.cn/direct/c6e9d03bdce74144bc5bb28b1c0d7e69.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="常量内存的使用">2. 常量内存的使用</h2><p><img src="https://i-blog.csdnimg.cn/direct/85fa2b9f0716492b8aa3343419f03861.png" alt="在这里插入图片描述" /> # 七、GPU缓存</p><h2 id="gpu缓存种类">1. GPU缓存种类</h2><figure><img src="https://i-blog.csdnimg.cn/direct/2a007e0cb22b446698223460d32db47d.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="gpu缓存作用">2. GPU缓存作用</h2><p><img src="https://i-blog.csdnimg.cn/direct/96acfa802fbd4d938849d8896f448e9e.png" alt="在这里插入图片描述" /> ## 3. L1缓存查询与设置 <img src="https://i-blog.csdnimg.cn/direct/e2f6377654c94246b7de1ba3d244f63e.png" alt="在这里插入图片描述" /> ## 4. L1缓存共享内存 <img src="https://i-blog.csdnimg.cn/direct/271e11ad845c4fb091b1b1af5c087f88.png" alt="在这里插入图片描述" /> <img src="https://i-blog.csdnimg.cn/direct/f0af6148afdc4f6882bbbc6612dce13f.png" alt="在这里插入图片描述" /></p>]]></content>
    
    
    <categories>
      
      <category>Infra</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Matrix Plus</title>
    <link href="/Infra/CUDA/infra/matrixAdd/"/>
    <url>/Infra/CUDA/infra/matrixAdd/</url>
    
    <content type="html"><![CDATA[<h1 id="一cuda矩阵加饭">一、CUDA矩阵加饭</h1><h2 id="cuda程序基本框架">1.1 CUDA程序基本框架</h2><figure><img src="https://i-blog.csdnimg.cn/direct/287801775fac4c588e4fbd70f0234b3b.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="设置gpu设备">1.2 设置GPU设备</h2><figure><img src="https://i-blog.csdnimg.cn/direct/344c9ecb8a3e4a9099ab564159a8acf4.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="内存管理">1.3 内存管理</h2><figure><img src="https://i-blog.csdnimg.cn/direct/7cf6827abf6b4d0eae16dba757126b3e.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/a3a5f8068587497b9b4c11272f4a07d8.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/215846984ad9417dbd6b5794644051bd.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/166e31671b1947f388779e35001d9e32.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/08678941f4f745829c8e1943d567cc28.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/5b58be5588ea4fb79c1963d2b14679ac.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><ul><li>主机不能调用设备函数</li></ul><h1 id="二cuda错误检查">二、CUDA错误检查</h1><h2 id="运行时api错误代码">1. 运行时API错误代码</h2><figure><img src="https://i-blog.csdnimg.cn/direct/05d2c94243e844eba6ce1df60882ae8c.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="错误检查函数">2. 错误检查函数</h2><figure><img src="https://i-blog.csdnimg.cn/direct/6ef177e14d7d43bd9fa080b85c79bffa.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/3268f3613b1f4decbd58cf9984beaea6.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="检查核函数">3. 检查核函数</h2><figure><img src="https://i-blog.csdnimg.cn/direct/af78970bc6bd445d8d5c5b50d9ca36db.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h1 id="三cuda计时">三、CUDA计时</h1><h2 id="时间计时">1. 时间计时</h2><figure><img src="https://i-blog.csdnimg.cn/direct/6eb1f09eaf6e4d07a5aed3892a007ab2.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="nvprof性能剖析">2. nvprof性能剖析</h2><figure><img src="https://i-blog.csdnimg.cn/direct/0f4f65fbfbd54fa8adf5e95a13376822.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>nsys nvprof ./***</p><h1 id="四运行时gpu信息查询">四、运行时GPU信息查询</h1><h2 id="运行时api查询gpu信息">1. 运行时API查询GPU信息</h2><figure><img src="https://i-blog.csdnimg.cn/direct/fd221ce6d25d42089d8058aff8c9cbe0.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/bcee2f715d07417babf9466064e6b8de.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><code class="hljs cpp">    <span class="hljs-keyword">struct</span> <span class="hljs-title class_">__device_builtin__</span> cudaDeviceProp<br>&#123;<br>    <span class="hljs-type">char</span>         name[<span class="hljs-number">256</span>];                  <span class="hljs-comment">/**&lt; ASCII string identifying device */</span><br>    cudaUUID_t   uuid;                       <span class="hljs-comment">/**&lt; 16-byte unique identifier */</span><br>    <span class="hljs-type">char</span>         luid[<span class="hljs-number">8</span>];                    <span class="hljs-comment">/**&lt; 8-byte locally unique identifier. Value is undefined on TCC and non-Windows platforms */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> luidDeviceNodeMask;         <span class="hljs-comment">/**&lt; LUID device node mask. Value is undefined on TCC and non-Windows platforms */</span><br>    <span class="hljs-type">size_t</span>       totalGlobalMem;             <span class="hljs-comment">/**&lt; Global memory available on device in bytes */</span><br>    <span class="hljs-type">size_t</span>       sharedMemPerBlock;          <span class="hljs-comment">/**&lt; Shared memory available per block in bytes */</span><br>    <span class="hljs-type">int</span>          regsPerBlock;               <span class="hljs-comment">/**&lt; 32-bit registers available per block */</span><br>    <span class="hljs-type">int</span>          warpSize;                   <span class="hljs-comment">/**&lt; Warp size in threads */</span><br>    <span class="hljs-type">size_t</span>       memPitch;                   <span class="hljs-comment">/**&lt; Maximum pitch in bytes allowed by memory copies */</span><br>    <span class="hljs-type">int</span>          maxThreadsPerBlock;         <span class="hljs-comment">/**&lt; Maximum number of threads per block */</span><br>    <span class="hljs-type">int</span>          maxThreadsDim[<span class="hljs-number">3</span>];           <span class="hljs-comment">/**&lt; Maximum size of each dimension of a block */</span><br>    <span class="hljs-type">int</span>          maxGridSize[<span class="hljs-number">3</span>];             <span class="hljs-comment">/**&lt; Maximum size of each dimension of a grid */</span><br>    <span class="hljs-type">size_t</span>       totalConstMem;              <span class="hljs-comment">/**&lt; Constant memory available on device in bytes */</span><br>    <span class="hljs-type">int</span>          major;                      <span class="hljs-comment">/**&lt; Major compute capability */</span><br>    <span class="hljs-type">int</span>          minor;                      <span class="hljs-comment">/**&lt; Minor compute capability */</span><br>    <span class="hljs-type">size_t</span>       textureAlignment;           <span class="hljs-comment">/**&lt; Alignment requirement for textures */</span><br>    <span class="hljs-type">size_t</span>       texturePitchAlignment;      <span class="hljs-comment">/**&lt; Pitch alignment requirement for texture references bound to pitched memory */</span><br>    <span class="hljs-type">int</span>          multiProcessorCount;        <span class="hljs-comment">/**&lt; Number of multiprocessors on device */</span><br>    <span class="hljs-type">int</span>          integrated;                 <span class="hljs-comment">/**&lt; Device is integrated as opposed to discrete */</span><br>    <span class="hljs-type">int</span>          canMapHostMemory;           <span class="hljs-comment">/**&lt; Device can map host memory with cudaHostAlloc/cudaHostGetDevicePointer */</span><br>    <span class="hljs-type">int</span>          maxTexture1D;               <span class="hljs-comment">/**&lt; Maximum 1D texture size */</span><br>    <span class="hljs-type">int</span>          maxTexture1DMipmap;         <span class="hljs-comment">/**&lt; Maximum 1D mipmapped texture size */</span><br>    <span class="hljs-type">int</span>          maxTexture2D[<span class="hljs-number">2</span>];            <span class="hljs-comment">/**&lt; Maximum 2D texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTexture2DMipmap[<span class="hljs-number">2</span>];      <span class="hljs-comment">/**&lt; Maximum 2D mipmapped texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTexture2DLinear[<span class="hljs-number">3</span>];      <span class="hljs-comment">/**&lt; Maximum dimensions (width, height, pitch) for 2D textures bound to pitched memory */</span><br>    <span class="hljs-type">int</span>          maxTexture2DGather[<span class="hljs-number">2</span>];      <span class="hljs-comment">/**&lt; Maximum 2D texture dimensions if texture gather operations have to be performed */</span><br>    <span class="hljs-type">int</span>          maxTexture3D[<span class="hljs-number">3</span>];            <span class="hljs-comment">/**&lt; Maximum 3D texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTexture3DAlt[<span class="hljs-number">3</span>];         <span class="hljs-comment">/**&lt; Maximum alternate 3D texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTextureCubemap;          <span class="hljs-comment">/**&lt; Maximum Cubemap texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTexture1DLayered[<span class="hljs-number">2</span>];     <span class="hljs-comment">/**&lt; Maximum 1D layered texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTexture2DLayered[<span class="hljs-number">3</span>];     <span class="hljs-comment">/**&lt; Maximum 2D layered texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxTextureCubemapLayered[<span class="hljs-number">2</span>];<span class="hljs-comment">/**&lt; Maximum Cubemap layered texture dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurface1D;               <span class="hljs-comment">/**&lt; Maximum 1D surface size */</span><br>    <span class="hljs-type">int</span>          maxSurface2D[<span class="hljs-number">2</span>];            <span class="hljs-comment">/**&lt; Maximum 2D surface dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurface3D[<span class="hljs-number">3</span>];            <span class="hljs-comment">/**&lt; Maximum 3D surface dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurface1DLayered[<span class="hljs-number">2</span>];     <span class="hljs-comment">/**&lt; Maximum 1D layered surface dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurface2DLayered[<span class="hljs-number">3</span>];     <span class="hljs-comment">/**&lt; Maximum 2D layered surface dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurfaceCubemap;          <span class="hljs-comment">/**&lt; Maximum Cubemap surface dimensions */</span><br>    <span class="hljs-type">int</span>          maxSurfaceCubemapLayered[<span class="hljs-number">2</span>];<span class="hljs-comment">/**&lt; Maximum Cubemap layered surface dimensions */</span><br>    <span class="hljs-type">size_t</span>       surfaceAlignment;           <span class="hljs-comment">/**&lt; Alignment requirements for surfaces */</span><br>    <span class="hljs-type">int</span>          concurrentKernels;          <span class="hljs-comment">/**&lt; Device can possibly execute multiple kernels concurrently */</span><br>    <span class="hljs-type">int</span>          ECCEnabled;                 <span class="hljs-comment">/**&lt; Device has ECC support enabled */</span><br>    <span class="hljs-type">int</span>          pciBusID;                   <span class="hljs-comment">/**&lt; PCI bus ID of the device */</span><br>    <span class="hljs-type">int</span>          pciDeviceID;                <span class="hljs-comment">/**&lt; PCI device ID of the device */</span><br>    <span class="hljs-type">int</span>          pciDomainID;                <span class="hljs-comment">/**&lt; PCI domain ID of the device */</span><br>    <span class="hljs-type">int</span>          tccDriver;                  <span class="hljs-comment">/**&lt; 1 if device is a Tesla device using TCC driver, 0 otherwise */</span><br>    <span class="hljs-type">int</span>          asyncEngineCount;           <span class="hljs-comment">/**&lt; Number of asynchronous engines */</span><br>    <span class="hljs-type">int</span>          unifiedAddressing;          <span class="hljs-comment">/**&lt; Device shares a unified address space with the host */</span><br>    <span class="hljs-type">int</span>          memoryBusWidth;             <span class="hljs-comment">/**&lt; Global memory bus width in bits */</span><br>    <span class="hljs-type">int</span>          l2CacheSize;                <span class="hljs-comment">/**&lt; Size of L2 cache in bytes */</span><br>    <span class="hljs-type">int</span>          persistingL2CacheMaxSize;   <span class="hljs-comment">/**&lt; Device&#x27;s maximum l2 persisting lines capacity setting in bytes */</span><br>    <span class="hljs-type">int</span>          maxThreadsPerMultiProcessor;<span class="hljs-comment">/**&lt; Maximum resident threads per multiprocessor */</span><br>    <span class="hljs-type">int</span>          streamPrioritiesSupported;  <span class="hljs-comment">/**&lt; Device supports stream priorities */</span><br>    <span class="hljs-type">int</span>          globalL1CacheSupported;     <span class="hljs-comment">/**&lt; Device supports caching globals in L1 */</span><br>    <span class="hljs-type">int</span>          localL1CacheSupported;      <span class="hljs-comment">/**&lt; Device supports caching locals in L1 */</span><br>    <span class="hljs-type">size_t</span>       sharedMemPerMultiprocessor; <span class="hljs-comment">/**&lt; Shared memory available per multiprocessor in bytes */</span><br>    <span class="hljs-type">int</span>          regsPerMultiprocessor;      <span class="hljs-comment">/**&lt; 32-bit registers available per multiprocessor */</span><br>    <span class="hljs-type">int</span>          managedMemory;              <span class="hljs-comment">/**&lt; Device supports allocating managed memory on this system */</span><br>    <span class="hljs-type">int</span>          isMultiGpuBoard;            <span class="hljs-comment">/**&lt; Device is on a multi-GPU board */</span><br>    <span class="hljs-type">int</span>          multiGpuBoardGroupID;       <span class="hljs-comment">/**&lt; Unique identifier for a group of devices on the same multi-GPU board */</span><br>    <span class="hljs-type">int</span>          hostNativeAtomicSupported;  <span class="hljs-comment">/**&lt; Link between the device and the host supports native atomic operations */</span><br>    <span class="hljs-type">int</span>          pageableMemoryAccess;       <span class="hljs-comment">/**&lt; Device supports coherently accessing pageable memory without calling cudaHostRegister on it */</span><br>    <span class="hljs-type">int</span>          concurrentManagedAccess;    <span class="hljs-comment">/**&lt; Device can coherently access managed memory concurrently with the CPU */</span><br>    <span class="hljs-type">int</span>          computePreemptionSupported; <span class="hljs-comment">/**&lt; Device supports Compute Preemption */</span><br>    <span class="hljs-type">int</span>          canUseHostPointerForRegisteredMem; <span class="hljs-comment">/**&lt; Device can access host registered memory at the same virtual address as the CPU */</span><br>    <span class="hljs-type">int</span>          cooperativeLaunch;          <span class="hljs-comment">/**&lt; Device supports launching cooperative kernels via ::cudaLaunchCooperativeKernel */</span><br>    <span class="hljs-type">size_t</span>       sharedMemPerBlockOptin;     <span class="hljs-comment">/**&lt; Per device maximum shared memory per block usable by special opt in */</span><br>    <span class="hljs-type">int</span>          pageableMemoryAccessUsesHostPageTables; <span class="hljs-comment">/**&lt; Device accesses pageable memory via the host&#x27;s page tables */</span><br>    <span class="hljs-type">int</span>          directManagedMemAccessFromHost; <span class="hljs-comment">/**&lt; Host can directly access managed memory on the device without migration. */</span><br>    <span class="hljs-type">int</span>          maxBlocksPerMultiProcessor; <span class="hljs-comment">/**&lt; Maximum number of resident blocks per multiprocessor */</span><br>    <span class="hljs-type">int</span>          accessPolicyMaxWindowSize;  <span class="hljs-comment">/**&lt; The maximum value of ::cudaAccessPolicyWindow::num_bytes. */</span><br>    <span class="hljs-type">size_t</span>       reservedSharedMemPerBlock;  <span class="hljs-comment">/**&lt; Shared memory reserved by CUDA driver per block in bytes */</span><br>    <span class="hljs-type">int</span>          hostRegisterSupported;      <span class="hljs-comment">/**&lt; Device supports host memory registration via ::cudaHostRegister. */</span><br>    <span class="hljs-type">int</span>          sparseCudaArraySupported;   <span class="hljs-comment">/**&lt; 1 if the device supports sparse CUDA arrays and sparse CUDA mipmapped arrays, 0 otherwise */</span><br>    <span class="hljs-type">int</span>          hostRegisterReadOnlySupported; <span class="hljs-comment">/**&lt; Device supports using the ::cudaHostRegister flag cudaHostRegisterReadOnly to register memory that must be mapped as read-only to the GPU */</span><br>    <span class="hljs-type">int</span>          timelineSemaphoreInteropSupported; <span class="hljs-comment">/**&lt; External timeline semaphore interop is supported on the device */</span><br>    <span class="hljs-type">int</span>          memoryPoolsSupported;       <span class="hljs-comment">/**&lt; 1 if the device supports using the cudaMallocAsync and cudaMemPool family of APIs, 0 otherwise */</span><br>    <span class="hljs-type">int</span>          gpuDirectRDMASupported;     <span class="hljs-comment">/**&lt; 1 if the device supports GPUDirect RDMA APIs, 0 otherwise */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> gpuDirectRDMAFlushWritesOptions; <span class="hljs-comment">/**&lt; Bitmask to be interpreted according to the ::cudaFlushGPUDirectRDMAWritesOptions enum */</span><br>    <span class="hljs-type">int</span>          gpuDirectRDMAWritesOrdering;<span class="hljs-comment">/**&lt; See the ::cudaGPUDirectRDMAWritesOrdering enum for numerical values */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> memoryPoolSupportedHandleTypes; <span class="hljs-comment">/**&lt; Bitmask of handle types supported with mempool-based IPC */</span><br>    <span class="hljs-type">int</span>          deferredMappingCudaArraySupported; <span class="hljs-comment">/**&lt; 1 if the device supports deferred mapping CUDA arrays and CUDA mipmapped arrays */</span><br>    <span class="hljs-type">int</span>          ipcEventSupported;          <span class="hljs-comment">/**&lt; Device supports IPC Events. */</span><br>    <span class="hljs-type">int</span>          clusterLaunch;              <span class="hljs-comment">/**&lt; Indicates device supports cluster launch */</span><br>    <span class="hljs-type">int</span>          unifiedFunctionPointers;    <span class="hljs-comment">/**&lt; Indicates device supports unified pointers */</span><br>    <span class="hljs-type">int</span>          deviceNumaConfig;           <span class="hljs-comment">/**&lt; NUMA configuration of a device: value is of type ::cudaDeviceNumaConfig enum */</span><br>    <span class="hljs-type">int</span>          deviceNumaId;               <span class="hljs-comment">/**&lt; NUMA node ID of the GPU memory */</span><br>    <span class="hljs-type">int</span>          mpsEnabled;                 <span class="hljs-comment">/**&lt; Indicates if contexts created on this device will be shared via MPS */</span><br>    <span class="hljs-type">int</span>          hostNumaId;                 <span class="hljs-comment">/**&lt; NUMA ID of the host node closest to the device or -1 when system does not support NUMA */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> gpuPciDeviceID; <span class="hljs-comment">/**&lt; The combined 16-bit PCI device ID and 16-bit PCI vendor ID */</span><br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> gpuPciSubsystemID; <span class="hljs-comment">/**&lt; The combined 16-bit PCI subsystem ID and 16-bit PCI subsystem vendor ID */</span><br>    <span class="hljs-type">int</span>          hostNumaMultinodeIpcSupported; <span class="hljs-comment">/**&lt; 1 if the device supports HostNuma location IPC between nodes in a multi-node system. */</span><br>    <span class="hljs-type">int</span>          reserved[<span class="hljs-number">56</span>];               <span class="hljs-comment">/**&lt; Reserved for future use */</span><br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="查询gpu计算核心数量">2. 查询GPU计算核心数量</h2><h1 id="五组织线程模型">五、组织线程模型</h1><h2 id="二维网格二维线程块">1. 二维网格二维线程块</h2><figure><img src="https://i-blog.csdnimg.cn/direct/c5655ac0ac0f49feba53d460559f1952.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/99b5cf5fdb584a51a8ec9241f027b21c.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/9edef9c707ec4fa0b87a2d7ceaa0add2.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>nx = blockDim.x * gridDim.x</p><p>nx: 矩阵宽</p><p>ny：矩阵长</p><h2 id="二维网格一维线程块">2. 二维网格一维线程块</h2><figure><img src="https://i-blog.csdnimg.cn/direct/dd83ef7f31534d1db9cec2e579147abe.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/9c0290763b65457f847e05f57a1a4e0f.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="一维网格一维线程块">3. 一维网格一维线程块</h2><figure><img src="https://i-blog.csdnimg.cn/direct/46e0db335c7f42c5938b0cce123e692f.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure>]]></content>
    
    
    <categories>
      
      <category>Infra</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CUDA Programming</title>
    <link href="/Infra/CUDA/infra/programming/"/>
    <url>/Infra/CUDA/infra/programming/</url>
    
    <content type="html"><![CDATA[<h1 id="一核函数">一、核函数</h1><ol type="1"><li><p>核函数在GPU上并行执行</p></li><li><p>注意</p><ul><li>限定词__global__修饰</li><li>返回值必须是void</li></ul></li><li><p>形式</p><ol type="1"><li><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">__global__ <span class="hljs-type">void</span> <span class="hljs-title">kernel_function</span><span class="hljs-params">(argument arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></p></li><li><p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">void</span> __global__ <span class="hljs-title">kernel_function</span><span class="hljs-params">(argument arg)</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello world\n&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure></p></li></ol></li></ol><ul><li><p>核函数只能返回GPU内存</p></li><li><p>核函数不能使用变长参数</p></li><li><p>核函数不能使用静态变量</p></li><li><p>核函数不能使用函数指针</p></li><li><p><strong>核函数具有异步性，需要用cudaDeviceSynchronize()同步</strong></p></li></ul><p><strong>CUDA程序编写流程：</strong></p><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-comment">// 主机代码</span><br>    <span class="hljs-comment">// 核函数调用</span><br>    <span class="hljs-comment">// 主机代码</span><br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>注意： 核函数不支持C++的iostream</p><h1 id="二-cuda线程模型">二、 CUDA线程模型</h1><h2 id="线程模型结构">1. 线程模型结构</h2><ol type="1"><li>线程模型重要概念：</li></ol><ul><li>grid 网格</li><li>block 线程块，包含一组线程</li><li>thread 线程 最小单位</li></ul><figure><img src="https://i-blog.csdnimg.cn/direct/7c22f319416e489b9759c08e76b3f848.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><ol start="2" type="1"><li><p>线程分块是逻辑上的划分，物理上线程不分块</p></li><li><p>配置线程：&lt;&lt;&lt;grid_size, block_size&gt;&gt;&gt;， 一个grid grid_size个block，一个block block_size个thread</p></li><li><p>最大允许线程块大小：1024</p><p>最大允许网格大小：<span class="math inline">\(2^{31} - 1\)</span> （针对唯一网格）</p></li></ol><h2 id="一维线程模型">2. 一维线程模型</h2><ol type="1"><li><p>每个线程在核函数中都有一个唯一的身份标识；</p></li><li><p>每个线程的唯一标识由这两个&lt;&lt;&lt;grid_size, block_size&gt;&gt;&gt;确定；grid_size, block_size保存在内建变量（build-in variable），<strong>目前考虑的是一维的情况：</strong></p></li></ol><ul><li><p>gridDim.x：该变量的数值等于执行配置中变量grid_size的值；</p></li><li><p>blockDim.x：该变量的数值等于执行配置中变量block_size的值。</p></li></ul><ol start="3" type="1"><li>线程索引保存成内建变量</li></ol><ul><li><p>blockIdx.x：改变量指定一个线程在一个网格中的线程块索引值，范围为0~gridDim.x-1；</p></li><li><p>threadIdx.x：该变量指定一个线程在一个线程块中的线程索引值，范围为0~blockDim.x - 1。</p></li></ul><p>example:</p><p>kernel_func&lt;&lt;&lt;2, 4&gt;&gt;&gt;();</p><p>gridDimx.x = 2</p><p>blockDimx.x = 4</p><p>0 &lt;= blockIdx.x &lt;= 1</p><p>0 &lt;= threadIdx.x &lt;= 3</p><p>线程唯一标识：</p><p>Idx = threadIdx.x + blockIdx.x * blockDim.x</p><h2 id="多维线程模型">3. 多维线程模型</h2><ol type="1"><li><p>CUDA可以组织三维的网格和线程块；</p></li><li><p>blockIdx和threadIdx是类型为uint3的变量，该类型是一个结构体，具有x, y, z三个成员，三个成员都为无符号类型</p></li><li><p>gridDim和blockDim是类型为dim3的变量，也是一个结构体，具有x,y,z三个成员</p></li><li><p>取值范围与一维一致</p></li></ol><p><strong>内建变量只在核函数有效，且无需定义</strong></p><p>定义多维网格和线程块</p><p>dim3 grid_size(Gx, Gy, Gz)</p><p>dim3 block_size(Bx, By, Bz)</p><p>example:</p><p>dim3 grid_size(2, 2) // 等价于dim3 grid_size(2, 2，1)</p><p>dim3 block_size(5, 3) // 等价于dim3 block_size(5, 3，1)</p><p><strong>多为网格和多维线程块本质是一维的，GPU物理上不分块</strong></p><p><strong>每个线程都有唯一标识（二维）</strong></p><p>int tid = threadIdx.y * blockDim.x + threadIdx.x;</p><p>int bid = blockIdx.y * gridDim.x + blockIdx.x;</p><figure><img src="https://i-blog.csdnimg.cn/direct/e1c59702a8714ac795efa194c9453b0f.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>图中block(2, 1) bid = 1 * 3 + 2 = 5</p><p>thread(3, 2) tid = 2 * 5 + 3</p><p><strong>每个线程都有唯一标识（三维）</strong></p><p>int tid = threadIdx.z * blockDim.x * blockDim.y (channel) + threadIdx.y * blockDim.x (y dim) + threadIdx.x (x dim);</p><p>int bid = blockIdx.z * gridDim.x * gridDim.y + blockIdx.y * gridDim.x + blockIdx.x;</p><h2 id="网格和线程块的限制条件">4. 网格和线程块的限制条件</h2><p>网格大小：</p><ul><li><p>gridDim.x 最大值： <span class="math inline">\(2^{31} - 1\)</span></p></li><li><p>gridDim.y 最大值： <span class="math inline">\(2^{16} - 1\)</span></p></li><li><p>gridDim.z 最大值： <span class="math inline">\(2^{16} - 1\)</span></p></li></ul><p>线程块大小限制：</p><ul><li><p>blockDim.x 最大值： 1024</p></li><li><p>blockDim.y 最大值： 1024</p></li><li><p>blockDim.z 最大值： 64</p></li></ul><p><strong>注意：线程块总大小最大为1024</strong></p><h1 id="三线程全局索引计算方式">三、线程全局索引计算方式</h1><h2 id="线程全局索引">1. 线程全局索引</h2><h3 id="一维网格一维线程块">1.1 一维网格一维线程块</h3><figure><img src="https://i-blog.csdnimg.cn/direct/e1b5d4a86e964a948eecadda0e0c1e8c.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>example:</p><p>bid = 2;</p><p>tid = 1;</p><p>id = 8 * 2 + 1 = 17</p><h3 id="二维网格二维线程块">1.2 二维网格二维线程块</h3><figure><img src="https://i-blog.csdnimg.cn/direct/99f2a8d0277d4076bee3d152db6df899.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>example:</p><p>bid = 2 * 1 + 1 = 3;</p><p>tid = 4 * 2 + 1 = 9;</p><p>id = 4 * 4 * 2 + 9 = 41</p><h3 id="三维网格三维线程块">1.3 三维网格三维线程块</h3><figure><img src="https://i-blog.csdnimg.cn/direct/597939a7aff844f884a3906925e06847.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>example:</p><p>bid = 0 * 2 * 2 + 1 * 2 + 0 = 2;</p><p>tid = 0 * 4 * 4 + 2 * 4 + 1 = 9;</p><p>id = 4 * 4 * 2 * bid + tid = 32 * 2 + 9 = 73</p><h2 id="不同组合方式列举">2. 不同组合方式列举</h2><figure><img src="https://i-blog.csdnimg.cn/direct/d89ada379f864cd58f84ec0b56b7a392.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/e6808fa1e5d040e685f1d822cc01d4e6.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/151bd3e7d4744bcabeb9736769cb8498.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h1 id="四nvcc编译流程与gpu计算能力">四、nvcc编译流程与GPU计算能力</h1><h2 id="nvcc编译流程">1. nvcc编译流程</h2><h3 id="编译流程">1.1 编译流程</h3><figure><img src="https://i-blog.csdnimg.cn/direct/ab308e2d16654d259f4bc012acaa3402.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><figure><img src="https://i-blog.csdnimg.cn/direct/61c985aac5224281ab2a831774810d9b.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h3 id="ptx">1.2 PTX</h3><p>PTX作用：虚拟计算架构和真实架构之间的桥梁</p><figure><img src="https://i-blog.csdnimg.cn/direct/fc77366a178d474c9f48e17e67a24b83.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p><strong>实际计算能力必须高于虚拟计算能力才能编译通过</strong></p><h2 id="gpu计算能力">2. GPU计算能力</h2><p><strong>不同cubin在不同架构不兼容</strong></p><figure><img src="https://i-blog.csdnimg.cn/direct/6c27d44319fe40e0aa54400b79fb7dee.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p><strong>主版本号相同的不同架构可以兼容</strong></p><figure><img src="https://i-blog.csdnimg.cn/direct/f5512b9afe914a01adf2efa31017a3dd.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>括号中为单精度计算峰值</p><p>2070性能低于V100，但是计算能力高于V100</p><h1 id="五cuda程序兼容性问题">五、CUDA程序兼容性问题</h1><h2 id="指定虚拟架构计算能力">1. 指定虚拟架构计算能力</h2><figure><img src="https://i-blog.csdnimg.cn/direct/5c3f77944069456092ef1b24c6e949e0.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="指定真是架构计算能力">2. 指定真是架构计算能力</h2><figure><img src="https://i-blog.csdnimg.cn/direct/e12983f45d39423b9e94ea46de9c4bc2.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="指定多个gpu版本编译">3. 指定多个GPU版本编译</h2><figure><img src="https://i-blog.csdnimg.cn/direct/3da1a81bdd2a47fc83de0b886b809366.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><h2 id="nvcc即时编译">4. nvcc即时编译</h2><figure><img src="https://img-home.csdnimg.cn/images/20230724024159.png?origin_url=5cdb3adea1f6b4d68aeb8d7b1176fd54.jpg&amp;pos_id=img-uvfC7ThU-1770565168266" alt="外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传" /><figcaption>外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传</figcaption></figure><p>缺点：可能不能完全发挥高版本架构的性能</p><h2 id="nvcc编译默认计算能力">5. nvcc编译默认计算能力</h2><figure><img src="https://i-blog.csdnimg.cn/direct/1fb334a419f84cce9d0e5502a453d887.jpeg" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><p>nvcc ***.cu -ptx</p><p>通过.target sm_**确认主版本号和次版本号</p>]]></content>
    
    
    <categories>
      
      <category>Infra</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Introduction</title>
    <link href="/Infra/CUDA/infra/CUDA%20Fundamentals%20Introduction/"/>
    <url>/Infra/CUDA/infra/CUDA%20Fundamentals%20Introduction/</url>
    
    <content type="html"><![CDATA[<h1 id="一cuda简介">一、CUDA简介</h1><h2 id="gpu硬件平台">1.1 GPU硬件平台</h2><ul><li><p>GPU 数据运算</p></li><li><p>CPU 逻辑运算</p></li><li><p>GPU性能指标</p><ol type="1"><li><p>核心数</p></li><li><p>GPU显存容量</p></li><li><p>GPU计算峰值</p></li><li><p>显存带宽</p></li></ol></li></ul><h2 id="cpugpu异构架构">1.2 CPU+GPU异构架构</h2><p>CPU起到控制作用，一般称为主机（host）</p><p>GPU可以看作是CPU的协处理器，一般称为设备（device）</p><p>主机和设备之间内存访问一般通过PCIe总线链接，PCIe传输较慢，对于小任务瓶颈是IO</p><h2 id="cuda介绍">1.3 CUDA介绍</h2><p>建立在GPU上的一个通用并行计算平台和编程模型</p><p>CUDA提供两层API接口，CUDA驱动（driver）API和CUDA运行时（runtime）API，两种API调用性能几乎无差异，runtime API对用户更友好（C/C++），driver API（汇编）</p><h1 id="二nvidia-smi">二、nvidia-smi</h1><figure><img src="https://i-blog.csdnimg.cn/direct/4c47d179b4da4ad8a9a8a298560b5db5.png" alt="在这里插入图片描述" /><figcaption>在这里插入图片描述</figcaption></figure><ol type="1"><li>nvidia-smi版本号</li><li>驱动版本</li><li>CUDA版</li><li>GPU型号及序号</li><li>风扇</li><li>温度</li><li>Perf：性能状态，P0~P12</li><li>Persistence-M：持续模式状态</li><li>Pwr：显卡功率</li><li>Bus-Id：显卡总线</li><li>Disp.A：Display Activate，表示GPU是否初始化</li><li>Memory-Usage：显存使用率</li><li>Volatile GPU-Util：GPU使用率</li><li>ECC：是否开启错误检查和纠错技术，0：disabled，1：enabled</li><li>Compute M：计算模式</li></ol><p>查询GPU详细信息：nvidia-smi -q</p><p>查询特定GPU详细信息：nvidia-smi -q -i 0</p><p>显示GPU特定信息：nvidia-smi -q -i 0 -d MEMORY</p><p>帮助命令：nvidia-smi -h</p>]]></content>
    
    
    <categories>
      
      <category>Infra</category>
      
      <category>CUDA</category>
      
    </categories>
    
    
    <tags>
      
      <tag>CUDA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>C/C++ Cookbook</title>
    <link href="/Programming/C-C/C++%20Cookbook/"/>
    <url>/Programming/C-C/C++%20Cookbook/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Programming/C-C/C++%20Cookbook/STL/">STL</a></p><p><a href="https://chenxindaaa.com/Programming/C-C/C++%20Cookbook/GDB/">GDB</a></p><p><a href="https://chenxindaaa.com/Programming/C-C/C++%20Cookbook/inline/">inline</a></p><p><a href="https://chenxindaaa.com/Programming/C-C/C++%20Cookbook/Move/">inline</a></p><p><a href="https://chenxindaaa.com/Programming/C-C/C++%20Cookbook/Lambda%20Expression/">Lambda Expression</a></p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>C/C++</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Machine Learning</title>
    <link href="/Artificial-Intelligence/ML/ML/"/>
    <url>/Artificial-Intelligence/ML/ML/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLeaning_PCA/">PCA</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_AdaBoost/">AdaBoost</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_FP-growth/">FP-growth</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_K-NN/">K-NN</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_LogisticsRegression/">Logistics Regression</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_NoiveBayes/">Noive Bayes</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_Regression/">Regression</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachinLearning_Apriori/">Apriori</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachinLearning_Cluster/">Cluster</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachinLearning_DecisionTree/">Decision Tree</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachinLearning_SVM/">SVM</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_AHP/">Analytic Hierarchy Process</a></p><p><a href="https://chenxindaaa.com/Artificial-Intelligence/ML/ML/MachineLearning_FCE/">Fuzzy Comprehension Evaluation</a></p>]]></content>
    
    
    <categories>
      
      <category>Artificial Intelligence</category>
      
      <category>ML</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python Cookbook</title>
    <link href="/Programming/Python/Python%20Cookbook/"/>
    <url>/Programming/Python/Python%20Cookbook/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Programming/Python/Python%20Cookbook/Decorators/">Decorators</a></p><p><a href="https://chenxindaaa.com/Programming/Python/Python%20Cookbook/classmethod,staticmethod,property//">classmethod, staticmethod and property</a></p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>Python</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>MATLAB</title>
    <link href="/Programming/MATLAB/MATLAB/"/>
    <url>/Programming/MATLAB/MATLAB/</url>
    
    <content type="html"><![CDATA[<meta name="referrer" content="no-referrer"/><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础01.%20.m文件/">Matlab基础01. .m文件</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础02.%20条件循环/">Matlab基础02. 条件循环</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础03.数据类型/">Matlab基础03.数据类型</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础04.结构数组/">Matlab基础04.结构数组</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础05.多维数组/">Matlab基础05.多维数组</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础05.多维数组/">Matlab基础05.多维数组</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础06.第三章习题/">Matlab基础06.第三章习题</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础07.二维图/">Matlab基础07.二维图</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础08.三维图/">Matlab基础08.三维图</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/Matlab基础09.%20图形属性设置及习题/">Matlab基础09. 图形属性设置及习题</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/matlab基础10.线性代数/">matlab基础10.线性代数</a></p><p><a href="https://chenxindaaa.com/Programming/MATLAB/MATLAB/matlab基础11.matlab在微积分中的应用/">matlab基础11.matlab在微积分中的应用</a></p>]]></content>
    
    
    <categories>
      
      <category>Programming</category>
      
      <category>MATLAB</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title></title>
    <link href="/uncategorized/DSD/"/>
    <url>/uncategorized/DSD/</url>
    
    <content type="html"><![CDATA[<h1 id="foundamental">Foundamental</h1><figure><img src="image-13.png" alt="alt text" /><figcaption>alt text</figcaption></figure><figure><img src="image-14.png" alt="alt text" /><figcaption>alt text</figcaption></figure>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
